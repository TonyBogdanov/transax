var __awaiter=this&&this.__awaiter||function(t,o,h,l){return new(h=h||Promise)(function(e,r){function n(t){try{i(l.next(t))}catch(t){r(t)}}function a(t){try{i(l.throw(t))}catch(t){r(t)}}function i(t){var r;t.done?e(t.value):((r=t.value)instanceof h?r:new h(function(t){t(r)})).then(n,a)}i((l=l.apply(t,o||[])).next())})};import{readFile}from"node:fs/promises";import{parse as parseYaml}from"yaml";import Util from"./Util.mjs";import PathError from"../Util/PathError.mjs";export default class PluginDictionary{constructor(t){if(!t||"object"!=typeof t)throw new PathError("Expected {{ path }} to be an object.");this.pattern=PathError.wrap("pattern",()=>{if("string"==typeof t.pattern&&0<t.pattern.length)return[t.pattern];if(Array.isArray(t.pattern)&&0<t.pattern.filter(t=>0<t.length).length)return t.pattern.filter(t=>0<t.length);throw new PathError("Expected {{ path }} to be a non-empty string or an array of non-empty strings.")}),this.handler=PathError.wrap("handler",()=>{const r=(t,e)=>__awaiter(this,void 0,void 0,function*(){var r=Util.localeFromPath(t);try{return{[r]:(yield e())||{}}}catch(t){return{[r]:{}}}});if("json"===t.handler)return t=>__awaiter(this,void 0,void 0,function*(){return r(t,()=>__awaiter(this,void 0,void 0,function*(){return JSON.parse(yield readFile(t,"utf8"))}))});if("yaml"===t.handler)return t=>__awaiter(this,void 0,void 0,function*(){return r(t,()=>__awaiter(this,void 0,void 0,function*(){return parseYaml(yield readFile(t,"utf8"))}))});if("function"==typeof t.handler)return t.handler;throw new PathError('Expected {{ path }} to be "yaml", "json" or a function.')})}}