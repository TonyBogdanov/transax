import Analyzer from"../Analyzer/Analyzer";import Compiler from"../Compiler/Compiler";import Logger from"../Logger/Logger";class Options{constructor(t={}){var s;this.translations=null!=(s=t.translations)?s:{},this.analyzer=null!=(s=t.analyzer)?s:new Analyzer,this.compiler=null!=(s=t.compiler)?s:new Compiler,this.logger=null!=(s=t.logger)?s:new Logger({namespace:"TRANSAX:GENERATOR"})}}export default class Generator{constructor(t={}){this.keys={},this.options=new Options(t)}parse(t,s,e=!1){if(!e&&s)for(var[o,r]of Object.entries(this.keys))this.keys[o]=r.filter(t=>t.split("::")[0]!==s),0===this.keys[o].length&&delete this.keys[o];for(const i of this.options.analyzer.analyze(t,s)){this.keys.hasOwnProperty(i.key)||(this.keys[i.key]=[]);var n=this.keys[i.key];const s=`${i.source||"[inline code]"}::${i.line}:`+i.column;n.includes(i.source)||n.push(s)}return this}setTranslations(t,s){return this.options.translations[t]=s,this}removeTranslations(t){return this.options.translations.hasOwnProperty(t)&&delete this.options.translations[t],this}getMissingTranslationKeys(){var t={};for(const s of Object.keys(this.options.translations)){const e=this.options.translations[s];t[s]=Object.keys(this.keys).filter(t=>!e.hasOwnProperty(t))}return t}getUnusedTranslationKeys(){var t={};for(const e of Object.keys(this.options.translations)){var s=this.options.translations[e];t[e]=Object.keys(s).filter(t=>!this.keys.hasOwnProperty(t))}return t}getCompiledTranslationsDump(t){var s=t=>t.match(/^[a-z_$][a-z0-9_$]*$/i)?t:JSON.stringify(t);let e=`{
`;for(const o of Object.keys(this.options.translations)){const r=this.options.translations[o];e+=`    ${s(o)}: {
`;for(const n of Object.keys(this.keys).filter(t=>r.hasOwnProperty(t)))t&&this.keys[n].forEach(t=>e+=`        // ${t}
`),e+=`        ${s(n)}: ${this.options.compiler.compile(r[n])},
`;e+=`    },
`}return e+"}"}getCompiledTranslationsDumpAsCJSExport(t){return`module.exports = ${this.getCompiledTranslationsDump(t)};
`}getCompiledTranslationsDumpAsESMExport(t){return`export default ${this.getCompiledTranslationsDump(t)};
`}}