import Analyzer from"../Analyzer/Analyzer";import Compiler from"../Compiler/Compiler";import Logger from"../Logger/Logger";class Options{constructor(s={}){var t;this.translations=null!=(t=s.translations)?t:{},this.analyzer=null!=(t=s.analyzer)?t:new Analyzer,this.compiler=null!=(t=s.compiler)?t:new Compiler,this.logger=null!=(t=s.logger)?t:new Logger({namespace:"TRANSAX:GENERATOR"})}}export default class Generator{constructor(s={}){this.keys={},this.options=new Options(s)}parse(s,t,e=!1){if(!e&&t)for(var[o,n]of Object.entries(this.keys))this.keys[o]=n.filter(s=>s.split("::")[0]!==t),0===this.keys[o].length&&delete this.keys[o];for(const i of this.options.analyzer.analyze(s,t)){this.keys.hasOwnProperty(i.key)||(this.keys[i.key]=[]);var r=this.keys[i.key];const t=`${i.source||"[inline code]"}::${i.line}:`+i.column;r.includes(i.source)||r.push(t)}return this}setTranslations(s,t){return this.options.translations[s]=t,this}removeTranslations(s){return this.options.translations.hasOwnProperty(s)&&delete this.options.translations[s],this}getMissingTranslationKeys(){var s={};for(const t of Object.keys(this.options.translations)){const e=this.options.translations[t];s[t]=Object.keys(this.keys).filter(s=>!e.hasOwnProperty(s))}return s}getUnusedTranslationKeys(){var s={};for(const e of Object.keys(this.options.translations)){var t=this.options.translations[e];s[e]=Object.keys(t).filter(s=>!this.keys.hasOwnProperty(s))}return s}getCompiledTranslationsDump(s){var t=s=>s.match(/^[a-z_$][a-z0-9_$]*$/i)?s:JSON.stringify(s);let e=`{
`;for(const o of Object.keys(this.options.translations)){const n=this.options.translations[o];e+=`    ${t(o)}: {
`;for(const r of Object.keys(this.keys).filter(s=>n.hasOwnProperty(s)))s&&("{\n"!==e.slice(-2)&&(e+="\n"),this.keys[r].forEach(s=>e+=`        // ${s}
`)),e+=`        ${t(r)}: ${this.options.compiler.compile(n[r])},
`;e+=`    },
`}return e+"}"}getCompiledTranslationsDumpAsCJSExport(s){return`module.exports = ${this.getCompiledTranslationsDump(s)};
`}getCompiledTranslationsDumpAsESMExport(s){return`export default ${this.getCompiledTranslationsDump(s)};
`}}