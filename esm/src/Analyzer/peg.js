import AnalyzerToken from"./AnalyzerToken";function peg$padEnd(t,r,e){return e=e||" ",t.length>r?t:(r-=t.length,t+(e+=e.repeat(r)).slice(0,r))}class PeggySyntaxError extends Error{static buildMessage(t,r){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+e(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+e(t))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+e(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+e(t))}function o(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var r=t.parts.map(t=>Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t));return"["+(t.inverted?"^":"")+r+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var r=t.map(o);let e,n;if(r.sort(),0<r.length){for(e=1,n=1;e<r.length;e++)r[e-1]!==r[e]&&(r[n]=r[e],n++);r.length=n}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(t)+" but "+((t=r)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,r,e,n){super(),this.message=t,this.expected=r,this.found=e,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(e){let n="Error: "+this.message;if(this.location){let t=null,r;for(r=0;r<e.length;r++)if(e[r].grammarSource===this.location.source){t=e[r].text.split(/\r\n|\n|\r/g);break}var a,o,c,u=this.location.start,s=this.location.source+":"+u.line+":"+u.column;t?(c=this.location.end,a=peg$padEnd("",u.line.toString().length," "),o=t[u.line-1],c=u.line===c.line?c.column:o.length+1,n+="\n --\x3e "+s+"\n"+a+" |\n"+u.line+" | "+o+"\n"+a+" | "+peg$padEnd("",u.column-1," ")+peg$padEnd("",c-u.column,"^")):n+="\n at "+s}return n}}function peg$parse(c,t){const u={},R=(t=void 0!==t?t:{}).grammarSource;var r={Start:ct};let e=ct;function M(t){return t.map(t=>"\\'"===t?t[1]:t).join("")}function U(t){return t.map(t=>'\\"'===t?t[1]:t).join("")}function q(t){return t.map(([,t])=>"\\`"===t?t[1]:t).join("")}const B=function(t){return t.flat().filter(t=>t instanceof AnalyzerToken)},D="(",G=w("(",!1),H=/^[,)]/,I=j([",",")"],!1,!1),J=function(t,r){return new AnalyzerToken(t,r,et(),nt().start.line,nt().start.column)},n=/^[ \t\r\n]/,a=j([" ","\t","\r","\n"],!1,!1),K=/^[^a-zA-Z_$]/,L=j([["a","z"],["A","Z"],"_","$"],!0,!1),N={type:"any"},Q=/^[a-zA-Z_$]/,V=j([["a","z"],["A","Z"],"_","$"],!1,!1),o=/^[a-zA-Z_$0-9]/,s=j([["a","z"],["A","Z"],"_","$",["0","9"]],!1,!1),W=et,l="'",i=w("'",!1),h="\\'",p=w("\\'",!1),f=/^[^']/,g=j(["'"],!0,!1),A='"',d=w('"',!1),y='\\"',m=w('\\"',!1),x=/^[^"]/,E=j(['"'],!0,!1),b="`",S=w("`",!1),$="${",X=w("${",!1),C="\\`",Y=w("\\`",!1),tt=/^[^`]/,rt=j(["`"],!0,!1);let v=0,z=0;const _=[{line:1,column:1}];let P=0,F=[],k=0;if(void 0!==t.startRule){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');e=r[t.startRule]}function et(){return c.substring(z,v)}function nt(){return T(z,v)}function w(t,r){return{type:"literal",text:t,ignoreCase:r}}function j(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function at(t){var r=_[t];let e;if(r)return r;for(e=t-1;!_[e];)e--;for(r={line:(r=_[e]).line,column:r.column};e<t;)10===c.charCodeAt(e)?(r.line++,r.column=1):r.column++,e++;return _[t]=r}function T(t,r){var e=at(t),n=at(r);return{source:R,start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:n.line,column:n.column}}}function Z(t){v<P||(v>P&&(P=v,F=[]),F.push(t))}function ot(t,r,e){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,r),t,r,e)}function ct(){let t,r,e,n,a;for(t=v,r=[],e=v,(n=st())===u&&(n=null),(e=n!==u&&(a=ut())!==u?n=[n,a]:(v=e,u))===u&&(e=lt());e!==u;)r.push(e),e=v,(n=st())===u&&(n=null),(e=n!==u&&(a=ut())!==u?n=[n,a]:(v=e,u))===u&&(e=lt());return r!==u&&(z=t,r=B(r)),r}function ut(){let t,r,e,n,a;return t=v,r=function(){let t,r,e,n;t=v,Q.test(c.charAt(v))?(r=c.charAt(v),v++):(r=u,0===k&&Z(V));if(r!==u){for(e=[],o.test(c.charAt(v))?(n=c.charAt(v),v++):(n=u,0===k&&Z(s));n!==u;)e.push(n),o.test(c.charAt(v))?(n=c.charAt(v),v++):(n=u,0===k&&Z(s));t=e!==u?(z=t,r=W()):(v=t,u)}else v=t,t=u;return t}(),t=r!==u&&O()!==u&&(40===c.charCodeAt(v)?(e=D,v++):(e=u,0===k&&Z(G)),e!==u)&&O()!==u&&(n=function(){let t,r,e,n,a,o;t=v,39===c.charCodeAt(v)?(r=l,v++):(r=u,0===k&&Z(i));if(r!==u){for(e=[],c.substr(v,2)===h?(n=h,v+=2):(n=u,0===k&&Z(p)),n===u&&(f.test(c.charAt(v))?(n=c.charAt(v),v++):(n=u,0===k&&Z(g)));n!==u;)e.push(n),c.substr(v,2)===h?(n=h,v+=2):(n=u,0===k&&Z(p)),n===u&&(f.test(c.charAt(v))?(n=c.charAt(v),v++):(n=u,0===k&&Z(g)));t=e!==u&&(39===c.charCodeAt(v)?(n=l,v++):(n=u,0===k&&Z(i)),n!==u)?(z=t,r=M(e)):(v=t,u)}else v=t,t=u;if(t===u){if(t=v,34===c.charCodeAt(v)?(r=A,v++):(r=u,0===k&&Z(d)),r!==u){for(e=[],c.substr(v,2)===y?(n=y,v+=2):(n=u,0===k&&Z(m)),n===u&&(x.test(c.charAt(v))?(n=c.charAt(v),v++):(n=u,0===k&&Z(E)));n!==u;)e.push(n),c.substr(v,2)===y?(n=y,v+=2):(n=u,0===k&&Z(m)),n===u&&(x.test(c.charAt(v))?(n=c.charAt(v),v++):(n=u,0===k&&Z(E)));t=e!==u&&(34===c.charCodeAt(v)?(n=A,v++):(n=u,0===k&&Z(d)),n!==u)?(z=t,r=U(e)):(v=t,u)}else v=t,t=u;if(t===u)if(t=v,96===c.charCodeAt(v)?(r=b,v++):(r=u,0===k&&Z(S)),r!==u){for(e=[],n=v,a=v,k++,c.substr(v,2)===$?(o=$,v+=2):(o=u,0===k&&Z(X)),k--,a=o===u?void 0:(v=a,u),n=a!==u&&(c.substr(v,2)===C?(o=C,v+=2):(o=u,0===k&&Z(Y)),o===u&&(tt.test(c.charAt(v))?(o=c.charAt(v),v++):(o=u,0===k&&Z(rt))),o!==u)?a=[a,o]:(v=n,u);n!==u;)e.push(n),n=v,a=v,k++,c.substr(v,2)===$?(o=$,v+=2):(o=u,0===k&&Z(X)),k--,a=o===u?void 0:(v=a,u),n=a!==u&&(c.substr(v,2)===C?(o=C,v+=2):(o=u,0===k&&Z(Y)),o===u&&(tt.test(c.charAt(v))?(o=c.charAt(v),v++):(o=u,0===k&&Z(rt))),o!==u)?a=[a,o]:(v=n,u);t=e!==u&&(96===c.charCodeAt(v)?(n=b,v++):(n=u,0===k&&Z(S)),n!==u)?(z=t,r=q(e)):(v=t,u)}else v=t,t=u}return t}())!==u&&O()!==u&&(H.test(c.charAt(v))?(a=c.charAt(v),v++):(a=u,0===k&&Z(I)),a!==u)?(z=t,J(r,n)):(v=t,u)}function O(){let t,r;for(t=[],n.test(c.charAt(v))?(r=c.charAt(v),v++):(r=u,0===k&&Z(a));r!==u;)t.push(r),n.test(c.charAt(v))?(r=c.charAt(v),v++):(r=u,0===k&&Z(a));return t}function st(){let t;return K.test(c.charAt(v))?(t=c.charAt(v),v++):(t=u,0===k&&Z(L)),t}function lt(){let t;return c.length>v?(t=c.charAt(v),v++):(t=u,0===k&&Z(N)),t}if((r=e())!==u&&v===c.length)return r;throw r!==u&&v<c.length&&Z({type:"end"}),ot(F,P<c.length?c.charAt(P):null,P<c.length?T(P,P+1):T(P,P))}const parse=peg$parse;export default parse;