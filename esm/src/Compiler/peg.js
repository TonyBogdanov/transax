import TextCompilerToken from"./TextCompilerToken";import LiteralCompilerToken from"./LiteralCompilerToken";import ExpressionCompilerToken from"./ExpressionCompilerToken";import IdentifierCompilerToken from"./IdentifierCompilerToken";import ObjectAccessCompilerToken from"./ObjectAccessCompilerToken";import ArrayAccessCompilerToken from"./ArrayAccessCompilerToken";function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}class PeggySyntaxError extends Error{static buildMessage(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function c(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var e=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+e+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var e=t.map(c);let r,n;if(e.sort(),0<e.length){for(r=1,n=1;r<e.length;r++)e[r-1]!==e[r]&&(e[n]=e[r],n++);e.length=n}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+((t=e)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,e,r,n){super(),this.message=t,this.expected=e,this.found=r,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(r){let n="Error: "+this.message;if(this.location){let t=null,e;for(e=0;e<r.length;e++)if(r[e].grammarSource===this.location.source){t=r[e].text.split(/\r\n|\n|\r/g);break}var o,c,a,i=this.location.start,s=this.location.source+":"+i.line+":"+i.column;t?(a=this.location.end,o=peg$padEnd("",i.line.toString().length," "),c=t[i.line-1],a=i.line===a.line?a.column:c.length+1,n+="\n --\x3e "+s+"\n"+o+" |\n"+i.line+" | "+c+"\n"+o+" | "+peg$padEnd("",i.column-1," ")+peg$padEnd("",a-i.column,"^")):n+="\n at "+s}return n}}function peg$parse(s,t){const u={},I=(t=void 0!==t?t:{}).grammarSource;var e={Start:It};let r=It;function R(t){return new LiteralCompilerToken(t,$(),F().start.line,F().start.column)}function Z(t,e){return new ExpressionCompilerToken(t,e,$(),F().start.line,F().start.column)}function U(t){return[t[0],...t[1]].join("")}const o=function(t){return t},l="",M=function(){return[]},N=function(t){return new TextCompilerToken($(),F().start.line,F().start.column)},c="{{",q=P("{{",!1),a="}}",B=P("}}",!1),D="@",G=P("@",!1),H=function(t,e){return new IdentifierCompilerToken(e,"@"===t,$(),F().start.line,F().start.column)},f=".",h=P(".",!1),J=function(t){return new ObjectAccessCompilerToken(t,$(),F().start.line,F().start.column)},K="[",Q=P("[",!1),V="]",W=P("]",!1),X=function(t){return new ArrayAccessCompilerToken(t,$(),F().start.line,F().start.column)},n=/^[ \t\r\n]/,i=_([" ","\t","\r","\n"],!1,!1),Y={type:"any"},p="null",tt=P("null",!1),A=function(){return null},et="NULL",rt=P("NULL",!1),nt="0",ot=P("0",!1),ct=function(){return 0},g="-",m=P("-",!1),at=/^[1-9]/,it=_([["1","9"]],!1,!1),d=/^[0-9]/,C=_([["0","9"]],!1,!1),st=function(t){return parseInt([t[0],t[1],...t[2]].join(""),10)},ut=function(t){return parseFloat([t[0],t[1],t[2].join(""),".",t[4].join("")].join(""))},lt=function(t){return parseFloat([...t.slice(0,3),...t[3]].join(""))},ft="'",ht=P("'",!1),x="\\'",pt=P("\\'",!1),At=/^[^']/,gt=_(["'"],!0,!1),mt=function(t){return t.map(t=>"\\'"===t?t[1]:t).join("")},dt='"',Ct=P('"',!1),y='\\"',xt=P('\\"',!1),yt=/^[^"]/,Tt=_(['"'],!0,!1),bt=function(t){return t.map(t=>'\\"'===t?t[1]:t).join("")},kt="`",Et=P("`",!1),T="${",jt=P("${",!1),b="\\`",St=P("\\`",!1),vt=/^[^`]/,wt=_(["`"],!0,!1),$t=function(t){return t.map(([,t])=>"\\`"===t?t[1]:t).join("")},Ft=/^[a-zA-Z_$]/,Pt=_([["a","z"],["A","Z"],"_","$"],!1,!1),_t=/^[a-zA-Z0-9_$]/,Lt=_([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1);let k=0,E=0;const j=[{line:1,column:1}];let S=0,v=[],w=0;if(void 0!==t.startRule){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=e[t.startRule]}function $(){return s.substring(E,k)}function F(){return L(E,k)}function P(t,e){return{type:"literal",text:t,ignoreCase:e}}function _(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Ot(t){var e=j[t];let r;if(e)return e;for(r=t-1;!j[r];)r--;for(e={line:(e=j[r]).line,column:e.column};r<t;)10===s.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return j[t]=e}function L(t,e){var r=Ot(t),n=Ot(e);return{source:I,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function O(t){k<S||(k>S&&(S=k,v=[]),v.push(t))}function zt(t,e,r){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,e),t,e,r)}function It(){let t,e,r;if(t=k,e=[],(r=(r=Zt())===u?Rt():r)!==u)for(;r!==u;)e.push(r),(r=Zt())===u&&(r=Rt());else e=u;return e!==u&&(E=t,e=o(e)),(t=e)===u&&(t=k,(e=l)!==u&&(E=t,e=M()),t=e),t}function Rt(){let t,e;return t=k,(e=function(){let t,e;t=k,s.length>k?(e=s.charAt(k),k++):(e=u,0===w&&O(Y));e!==u&&(E=t,e=o(e));return t=e}())!==u&&(E=t,e=N(e)),e}function Zt(){let t,e,r,n;return t=k,s.substr(k,2)===c?(e=c,k+=2):(e=u,0===w&&O(q)),t=e!==u&&z()!==u&&(r=(r=Ut())===u?Mt():r)!==u&&z()!==u&&(s.substr(k,2)===a?(n=a,k+=2):(n=u,0===w&&O(B)),n!==u)?(E=t,e=o(r)):(k=t,u)}function Ut(){let t,e;return t=k,(e=(e=function(){let t,e;t=k,s.substr(k,4)===p?(e=p,k+=4):(e=u,0===w&&O(tt));e!==u&&(E=t,e=A());(t=e)===u&&(t=k,s.substr(k,4)===et?(e=et,k+=4):(e=u,0===w&&O(rt)),e!==u&&(E=t,e=A()),t=e);return t}())===u&&(e=function(){let t,e,r,n,o,c;t=k,39===s.charCodeAt(k)?(e=ft,k++):(e=u,0===w&&O(ht));if(e!==u){for(r=[],s.substr(k,2)===x?(n=x,k+=2):(n=u,0===w&&O(pt)),n===u&&(At.test(s.charAt(k))?(n=s.charAt(k),k++):(n=u,0===w&&O(gt)));n!==u;)r.push(n),s.substr(k,2)===x?(n=x,k+=2):(n=u,0===w&&O(pt)),n===u&&(At.test(s.charAt(k))?(n=s.charAt(k),k++):(n=u,0===w&&O(gt)));t=r!==u&&(39===s.charCodeAt(k)?(n=ft,k++):(n=u,0===w&&O(ht)),n!==u)?(E=t,e=mt(r)):(k=t,u)}else k=t,t=u;if(t===u){if(t=k,34===s.charCodeAt(k)?(e=dt,k++):(e=u,0===w&&O(Ct)),e!==u){for(r=[],s.substr(k,2)===y?(n=y,k+=2):(n=u,0===w&&O(xt)),n===u&&(yt.test(s.charAt(k))?(n=s.charAt(k),k++):(n=u,0===w&&O(Tt)));n!==u;)r.push(n),s.substr(k,2)===y?(n=y,k+=2):(n=u,0===w&&O(xt)),n===u&&(yt.test(s.charAt(k))?(n=s.charAt(k),k++):(n=u,0===w&&O(Tt)));t=r!==u&&(34===s.charCodeAt(k)?(n=dt,k++):(n=u,0===w&&O(Ct)),n!==u)?(E=t,e=bt(r)):(k=t,u)}else k=t,t=u;if(t===u)if(t=k,96===s.charCodeAt(k)?(e=kt,k++):(e=u,0===w&&O(Et)),e!==u){for(r=[],n=k,o=k,w++,s.substr(k,2)===T?(c=T,k+=2):(c=u,0===w&&O(jt)),w--,o=c===u?void 0:(k=o,u),n=o!==u&&(s.substr(k,2)===b?(c=b,k+=2):(c=u,0===w&&O(St)),c===u&&(vt.test(s.charAt(k))?(c=s.charAt(k),k++):(c=u,0===w&&O(wt))),c!==u)?o=[o,c]:(k=n,u);n!==u;)r.push(n),n=k,o=k,w++,s.substr(k,2)===T?(c=T,k+=2):(c=u,0===w&&O(jt)),w--,o=c===u?void 0:(k=o,u),n=o!==u&&(s.substr(k,2)===b?(c=b,k+=2):(c=u,0===w&&O(St)),c===u&&(vt.test(s.charAt(k))?(c=s.charAt(k),k++):(c=u,0===w&&O(wt))),c!==u)?o=[o,c]:(k=n,u);t=r!==u&&(96===s.charCodeAt(k)?(n=kt,k++):(n=u,0===w&&O(Et)),n!==u)?(E=t,e=$t(r)):(k=t,u)}else k=t,t=u}return t}())===u&&(e=function(){let t,e,r,n,o,c,a,i;t=k,e=k,45===s.charCodeAt(k)?(r=g,k++):(r=u,0===w&&O(m));r===u&&(r=null);if(r!==u)if(at.test(s.charAt(k))?(n=s.charAt(k),k++):(n=u,0===w&&O(it)),n!==u){for(o=[],d.test(s.charAt(k))?(c=s.charAt(k),k++):(c=u,0===w&&O(C));c!==u;)o.push(c),d.test(s.charAt(k))?(c=s.charAt(k),k++):(c=u,0===w&&O(C));if(o!==u)if(46===s.charCodeAt(k)?(c=f,k++):(c=u,0===w&&O(h)),c!==u){if(a=[],d.test(s.charAt(k))?(i=s.charAt(k),k++):(i=u,0===w&&O(C)),i!==u)for(;i!==u;)a.push(i),d.test(s.charAt(k))?(i=s.charAt(k),k++):(i=u,0===w&&O(C));else a=u;e=a!==u?r=[r,n,o,c,a]:(k=e,u)}else k=e,e=u;else k=e,e=u}else k=e,e=u;else k=e,e=u;e!==u&&(E=t,e=ut(e));if((t=e)===u){if(t=k,e=k,45===s.charCodeAt(k)?(r=g,k++):(r=u,0===w&&O(m)),(r=r===u?null:r)!==u)if(48===s.charCodeAt(k)?(n=nt,k++):(n=u,0===w&&O(ot)),(n=n===u?l:n)!==u)if(46===s.charCodeAt(k)?(o=f,k++):(o=u,0===w&&O(h)),o!==u){if(c=[],d.test(s.charAt(k))?(a=s.charAt(k),k++):(a=u,0===w&&O(C)),a!==u)for(;a!==u;)c.push(a),d.test(s.charAt(k))?(a=s.charAt(k),k++):(a=u,0===w&&O(C));else c=u;e=c!==u?r=[r,n,o,c]:(k=e,u)}else k=e,e=u;else k=e,e=u;else k=e,e=u;e!==u&&(E=t,e=lt(e)),t=e}return t}())===u?function(){let t,e,r,n,o,c;t=k,48===s.charCodeAt(k)?(e=nt,k++):(e=u,0===w&&O(ot));e!==u&&(E=t,e=ct());if((t=e)===u){if(t=k,e=k,45===s.charCodeAt(k)?(r=g,k++):(r=u,0===w&&O(m)),(r=r===u?null:r)!==u)if(at.test(s.charAt(k))?(n=s.charAt(k),k++):(n=u,0===w&&O(it)),n!==u){for(o=[],d.test(s.charAt(k))?(c=s.charAt(k),k++):(c=u,0===w&&O(C));c!==u;)o.push(c),d.test(s.charAt(k))?(c=s.charAt(k),k++):(c=u,0===w&&O(C));e=o!==u?r=[r,n,o]:(k=e,u)}else k=e,e=u;else k=e,e=u;e!==u&&(E=t,e=st(e)),t=e}return t}():e)!==u&&(E=t,e=R(e)),e}function Mt(){let t,e,r,n;if(t=k,(e=function(){let t,e,r;t=k,64===s.charCodeAt(k)?(e=D,k++):(e=u,0===w&&O(G));e===u&&(e=null);t=e!==u&&(r=Bt(),r!==u)?(E=t,e=H(e,r)):(k=t,u);return t}())!==u){for(r=[],(n=Nt())===u&&(n=qt());n!==u;)r.push(n),(n=Nt())===u&&(n=qt());t=r!==u?(E=t,Z(e,r)):(k=t,u)}else k=t,t=u;return t}function Nt(){let t,e,r,n;return t=k,e=z(),t=e!==u&&(46===s.charCodeAt(k)?(r=f,k++):(r=u,0===w&&O(h)),r!==u)&&z()!==u&&(n=Bt())!==u?(E=t,J(n)):(k=t,u)}function qt(){let t,e,r,n,o;return t=k,e=z(),t=e!==u&&(91===s.charCodeAt(k)?(r=K,k++):(r=u,0===w&&O(Q)),r!==u)&&z()!==u&&(n=(n=Ut())===u?Mt():n)!==u&&z()!==u&&(93===s.charCodeAt(k)?(o=V,k++):(o=u,0===w&&O(W)),o!==u)?(E=t,X(n)):(k=t,u)}function z(){let t,e;for(t=[],n.test(s.charAt(k))?(e=s.charAt(k),k++):(e=u,0===w&&O(i));e!==u;)t.push(e),n.test(s.charAt(k))?(e=s.charAt(k),k++):(e=u,0===w&&O(i));return t}function Bt(){let t,e,r,n,o;if(t=k,e=k,Ft.test(s.charAt(k))?(r=s.charAt(k),k++):(r=u,0===w&&O(Pt)),r!==u){for(n=[],_t.test(s.charAt(k))?(o=s.charAt(k),k++):(o=u,0===w&&O(Lt));o!==u;)n.push(o),_t.test(s.charAt(k))?(o=s.charAt(k),k++):(o=u,0===w&&O(Lt));e=n!==u?r=[r,n]:(k=e,u)}else k=e,e=u;return e!==u&&(E=t,e=U(e)),e}if((e=r())!==u&&k===s.length)return e;throw e!==u&&k<s.length&&O({type:"end"}),zt(v,S<s.length?s.charAt(S):null,S<s.length?L(S,S+1):L(S,S))}const parse=peg$parse;export default parse;