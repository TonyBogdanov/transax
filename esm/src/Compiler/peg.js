import TextCompilerToken from"./TextCompilerToken";import LiteralCompilerToken from"./LiteralCompilerToken";import ExpressionCompilerToken from"./ExpressionCompilerToken";import IdentifierCompilerToken from"./IdentifierCompilerToken";import ObjectAccessCompilerToken from"./ObjectAccessCompilerToken";import ArrayAccessCompilerToken from"./ArrayAccessCompilerToken";import InvocationCompilerToken from"./InvocationCompilerToken";function peg$padEnd(t,r,e){return e=e||" ",t.length>r?t:(r-=t.length,t+(e+=e.repeat(r)).slice(0,r))}class PeggySyntaxError extends Error{static buildMessage(t,r){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+e(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+e(t))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+e(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+e(t))}function c(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var r=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+r+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var r=t.map(c);let e,n;if(r.sort(),0<r.length){for(e=1,n=1;e<r.length;e++)r[e-1]!==r[e]&&(r[n]=r[e],n++);r.length=n}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(t)+" but "+((t=r)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,r,e,n){super(),this.message=t,this.expected=r,this.found=e,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(e){let n="Error: "+this.message;if(this.location){let t=null,r;for(r=0;r<e.length;r++)if(e[r].grammarSource===this.location.source){t=e[r].text.split(/\r\n|\n|\r/g);break}var o,c,i,u=this.location.start,s=this.location.source+":"+u.line+":"+u.column;t?(i=this.location.end,o=peg$padEnd("",u.line.toString().length," "),c=t[u.line-1],i=u.line===i.line?i.column:c.length+1,n+="\n --\x3e "+s+"\n"+o+" |\n"+u.line+" | "+c+"\n"+o+" | "+peg$padEnd("",u.column-1," ")+peg$padEnd("",i-u.column,"^")):n+="\n at "+s}return n}}function peg$parse(s,t){const a={},R=(t=void 0!==t?t:{}).grammarSource;var r={Start:cr};let e=cr;function U(t){return new LiteralCompilerToken(t,j(),v().start.line,v().start.column)}function z(t,r){return new ExpressionCompilerToken(t,r,j(),v().start.line,v().start.column)}function Z(t){return[t[0],...t[1]].join("")}function M(t,r){return[t,...r.map(([,,,t])=>t)]}const o=function(t){return t},l="",N=function(){return[]},q=function(t){return new TextCompilerToken(j(),v().start.line,v().start.column)},c="{{",B=w("{{",!1),D="}}",G=w("}}",!1),H="@",J=w("@",!1),K=function(t,r){return new IdentifierCompilerToken(r,"@"===t,j(),v().start.line,v().start.column)},f=".",h=w(".",!1),Q=function(t){return new ObjectAccessCompilerToken(t,j(),v().start.line,v().start.column)},V="[",W=w("[",!1),X="]",Y=w("]",!1),tt=function(t){return new ArrayAccessCompilerToken(t,j(),v().start.line,v().start.column)},rt="(",et=w("(",!1),nt=")",ot=w(")",!1),ct=function(t){return new InvocationCompilerToken(null!=t?t:[],j(),v().start.line,v().start.column)},it=/^[ \t\r\n]/,ut=F([" ","\t","\r","\n"],!1,!1),st={type:"any"},at="null",lt=w("null",!1),ft=function(){return null},ht="NULL",pt=w("NULL",!1),At="true",mt=w("true",!1),gt=function(){return!0},dt="TRUE",Ct=w("TRUE",!1),xt="false",yt=w("false",!1),bt=function(){return!1},Tt="FALSE",kt=w("FALSE",!1),Et="0",St=w("0",!1),jt=function(){return 0},p="-",A=w("-",!1),vt=/^[1-9]/,wt=F([["1","9"]],!1,!1),m=/^[0-9]/,g=F([["0","9"]],!1,!1),Ft=function(t){return parseInt([t[0],t[1],...t[2]].join(""),10)},$t=function(t){return parseFloat([t[0],t[1],t[2].join(""),".",t[4].join("")].join(""))},Ot=function(t){return parseFloat([...t.slice(0,3),...t[3]].join(""))},Lt="'",Pt=w("'",!1),i="\\'",_t=w("\\'",!1),u="\\\\",d=w("\\\\",!1),It=/^[^']/,Rt=F(["'"],!0,!1),Ut=function(t){return t.map(t=>-1<["\\'","\\\\"].indexOf(t)?t[1]:t).join("")},zt='"',Zt=w('"',!1),C='\\"',Mt=w('\\"',!1),Nt=/^[^"]/,qt=F(['"'],!0,!1),Bt=function(t){return t.map(t=>-1<['\\"',"\\\\"].indexOf(t)?t[1]:t).join("")},Dt="`",Gt=w("`",!1),x="${",Ht=w("${",!1),y="\\`",Jt=w("\\`",!1),Kt=/^[^`]/,Qt=F(["`"],!0,!1),Vt=function(t){return t.map(([,t])=>-1<["\\`","\\\\"].indexOf(t)?t[1]:t).join("")},Wt=/^[a-zA-Z_$]/,Xt=F([["a","z"],["A","Z"],"_","$"],!1,!1),Yt=/^[a-zA-Z0-9_$]/,tr=F([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1),rr=",",er=w(",",!1);let b=0,T=0;const n=[{line:1,column:1}];let k=0,E=[],S=0;if(void 0!==t.startRule){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');e=r[t.startRule]}function j(){return s.substring(T,b)}function v(){return $(T,b)}function w(t,r){return{type:"literal",text:t,ignoreCase:r}}function F(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function nr(t){var r=n[t];let e;if(r)return r;for(e=t-1;!n[e];)e--;for(r={line:(r=n[e]).line,column:r.column};e<t;)10===s.charCodeAt(e)?(r.line++,r.column=1):r.column++,e++;return n[t]=r}function $(t,r){var e=nr(t),n=nr(r);return{source:R,start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:n.line,column:n.column}}}function O(t){b<k||(b>k&&(k=b,E=[]),E.push(t))}function or(t,r,e){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,r),t,r,e)}function cr(){let t,r,e;if(t=b,r=[],(e=(e=ur())===a?ir():e)!==a)for(;e!==a;)r.push(e),(e=ur())===a&&(e=ir());else r=a;return r!==a&&(T=t,r=o(r)),(t=r)===a&&(t=b,(r=l)!==a&&(T=t,r=N()),t=r),t}function ir(){let t,r;return t=b,(r=function(){let t,r;t=b,s.length>b?(r=s.charAt(b),b++):(r=a,0===S&&O(st));r!==a&&(T=t,r=o(r));return t=r}())!==a&&(T=t,r=q(r)),r}function ur(){let t,r,e,n;return t=b,s.substr(b,2)===c?(r=c,b+=2):(r=a,0===S&&O(B)),t=r!==a&&_()!==a&&(e=(e=L())===a?P():e)!==a&&_()!==a&&(s.substr(b,2)===D?(n=D,b+=2):(n=a,0===S&&O(G)),n!==a)?(T=t,r=o(e)):(b=t,a)}function L(){let t,r;return t=b,(r=(r=function(){let t,r;t=b,s.substr(b,4)===at?(r=at,b+=4):(r=a,0===S&&O(lt));r!==a&&(T=t,r=ft());(t=r)===a&&(t=b,s.substr(b,4)===ht?(r=ht,b+=4):(r=a,0===S&&O(pt)),r!==a&&(T=t,r=ft()),t=r);return t}())===a&&(r=function(){let t,r;t=b,s.substr(b,4)===At?(r=At,b+=4):(r=a,0===S&&O(mt));r!==a&&(T=t,r=gt());(t=r)===a&&(t=b,s.substr(b,4)===dt?(r=dt,b+=4):(r=a,0===S&&O(Ct)),r!==a&&(T=t,r=gt()),(t=r)===a)&&(t=b,s.substr(b,5)===xt?(r=xt,b+=5):(r=a,0===S&&O(yt)),r!==a&&(T=t,r=bt()),(t=r)===a)&&(t=b,s.substr(b,5)===Tt?(r=Tt,b+=5):(r=a,0===S&&O(kt)),r!==a&&(T=t,r=bt()),t=r);return t}())===a&&(r=function(){let t,r,e,n,o,c;t=b,39===s.charCodeAt(b)?(r=Lt,b++):(r=a,0===S&&O(Pt));if(r!==a){for(e=[],s.substr(b,2)===i?(n=i,b+=2):(n=a,0===S&&O(_t)),n===a&&(s.substr(b,2)===u?(n=u,b+=2):(n=a,0===S&&O(d)),n===a)&&(It.test(s.charAt(b))?(n=s.charAt(b),b++):(n=a,0===S&&O(Rt)));n!==a;)e.push(n),s.substr(b,2)===i?(n=i,b+=2):(n=a,0===S&&O(_t)),n===a&&(s.substr(b,2)===u?(n=u,b+=2):(n=a,0===S&&O(d)),n===a)&&(It.test(s.charAt(b))?(n=s.charAt(b),b++):(n=a,0===S&&O(Rt)));t=e!==a&&(39===s.charCodeAt(b)?(n=Lt,b++):(n=a,0===S&&O(Pt)),n!==a)?(T=t,r=Ut(e)):(b=t,a)}else b=t,t=a;if(t===a){if(t=b,34===s.charCodeAt(b)?(r=zt,b++):(r=a,0===S&&O(Zt)),r!==a){for(e=[],s.substr(b,2)===C?(n=C,b+=2):(n=a,0===S&&O(Mt)),n===a&&(s.substr(b,2)===u?(n=u,b+=2):(n=a,0===S&&O(d)),n===a)&&(Nt.test(s.charAt(b))?(n=s.charAt(b),b++):(n=a,0===S&&O(qt)));n!==a;)e.push(n),s.substr(b,2)===C?(n=C,b+=2):(n=a,0===S&&O(Mt)),n===a&&(s.substr(b,2)===u?(n=u,b+=2):(n=a,0===S&&O(d)),n===a)&&(Nt.test(s.charAt(b))?(n=s.charAt(b),b++):(n=a,0===S&&O(qt)));t=e!==a&&(34===s.charCodeAt(b)?(n=zt,b++):(n=a,0===S&&O(Zt)),n!==a)?(T=t,r=Bt(e)):(b=t,a)}else b=t,t=a;if(t===a)if(t=b,96===s.charCodeAt(b)?(r=Dt,b++):(r=a,0===S&&O(Gt)),r!==a){for(e=[],n=b,o=b,S++,s.substr(b,2)===x?(c=x,b+=2):(c=a,0===S&&O(Ht)),S--,o=c===a?void 0:(b=o,a),n=o!==a&&(s.substr(b,2)===y?(c=y,b+=2):(c=a,0===S&&O(Jt)),c===a&&(s.substr(b,2)===u?(c=u,b+=2):(c=a,0===S&&O(d)),c===a)&&(Kt.test(s.charAt(b))?(c=s.charAt(b),b++):(c=a,0===S&&O(Qt))),c!==a)?o=[o,c]:(b=n,a);n!==a;)e.push(n),n=b,o=b,S++,s.substr(b,2)===x?(c=x,b+=2):(c=a,0===S&&O(Ht)),S--,o=c===a?void 0:(b=o,a),n=o!==a&&(s.substr(b,2)===y?(c=y,b+=2):(c=a,0===S&&O(Jt)),c===a&&(s.substr(b,2)===u?(c=u,b+=2):(c=a,0===S&&O(d)),c===a)&&(Kt.test(s.charAt(b))?(c=s.charAt(b),b++):(c=a,0===S&&O(Qt))),c!==a)?o=[o,c]:(b=n,a);t=e!==a&&(96===s.charCodeAt(b)?(n=Dt,b++):(n=a,0===S&&O(Gt)),n!==a)?(T=t,r=Vt(e)):(b=t,a)}else b=t,t=a}return t}())===a&&(r=function(){let t,r,e,n,o,c,i,u;t=b,r=b,45===s.charCodeAt(b)?(e=p,b++):(e=a,0===S&&O(A));e===a&&(e=null);if(e!==a)if(vt.test(s.charAt(b))?(n=s.charAt(b),b++):(n=a,0===S&&O(wt)),n!==a){for(o=[],m.test(s.charAt(b))?(c=s.charAt(b),b++):(c=a,0===S&&O(g));c!==a;)o.push(c),m.test(s.charAt(b))?(c=s.charAt(b),b++):(c=a,0===S&&O(g));if(o!==a)if(46===s.charCodeAt(b)?(c=f,b++):(c=a,0===S&&O(h)),c!==a){if(i=[],m.test(s.charAt(b))?(u=s.charAt(b),b++):(u=a,0===S&&O(g)),u!==a)for(;u!==a;)i.push(u),m.test(s.charAt(b))?(u=s.charAt(b),b++):(u=a,0===S&&O(g));else i=a;r=i!==a?e=[e,n,o,c,i]:(b=r,a)}else b=r,r=a;else b=r,r=a}else b=r,r=a;else b=r,r=a;r!==a&&(T=t,r=$t(r));if((t=r)===a){if(t=b,r=b,45===s.charCodeAt(b)?(e=p,b++):(e=a,0===S&&O(A)),(e=e===a?null:e)!==a)if(48===s.charCodeAt(b)?(n=Et,b++):(n=a,0===S&&O(St)),(n=n===a?l:n)!==a)if(46===s.charCodeAt(b)?(o=f,b++):(o=a,0===S&&O(h)),o!==a){if(c=[],m.test(s.charAt(b))?(i=s.charAt(b),b++):(i=a,0===S&&O(g)),i!==a)for(;i!==a;)c.push(i),m.test(s.charAt(b))?(i=s.charAt(b),b++):(i=a,0===S&&O(g));else c=a;r=c!==a?e=[e,n,o,c]:(b=r,a)}else b=r,r=a;else b=r,r=a;else b=r,r=a;r!==a&&(T=t,r=Ot(r)),t=r}return t}())===a?function(){let t,r,e,n,o,c;t=b,48===s.charCodeAt(b)?(r=Et,b++):(r=a,0===S&&O(St));r!==a&&(T=t,r=jt());if((t=r)===a){if(t=b,r=b,45===s.charCodeAt(b)?(e=p,b++):(e=a,0===S&&O(A)),(e=e===a?null:e)!==a)if(vt.test(s.charAt(b))?(n=s.charAt(b),b++):(n=a,0===S&&O(wt)),n!==a){for(o=[],m.test(s.charAt(b))?(c=s.charAt(b),b++):(c=a,0===S&&O(g));c!==a;)o.push(c),m.test(s.charAt(b))?(c=s.charAt(b),b++):(c=a,0===S&&O(g));r=o!==a?e=[e,n,o]:(b=r,a)}else b=r,r=a;else b=r,r=a;r!==a&&(T=t,r=Ft(r)),t=r}return t}():r)!==a&&(T=t,r=U(r)),r}function P(){let t,r,e,n;if(t=b,(r=function(){let t,r,e;t=b,64===s.charCodeAt(b)?(r=H,b++):(r=a,0===S&&O(J));r===a&&(r=null);t=r!==a&&(e=fr(),e!==a)?(T=t,r=K(r,e)):(b=t,a);return t}())!==a){for(e=[],(n=sr())===a&&(n=ar())===a&&(n=lr());n!==a;)e.push(n),(n=sr())===a&&(n=ar())===a&&(n=lr());t=e!==a?(T=t,z(r,e)):(b=t,a)}else b=t,t=a;return t}function sr(){let t,r,e,n;return t=b,r=_(),t=r!==a&&(46===s.charCodeAt(b)?(e=f,b++):(e=a,0===S&&O(h)),e!==a)&&_()!==a&&(n=fr())!==a?(T=t,Q(n)):(b=t,a)}function ar(){let t,r,e,n,o;return t=b,r=_(),t=r!==a&&(91===s.charCodeAt(b)?(e=V,b++):(e=a,0===S&&O(W)),e!==a)&&_()!==a&&(n=(n=L())===a?P():n)!==a&&_()!==a&&(93===s.charCodeAt(b)?(o=X,b++):(o=a,0===S&&O(Y)),o!==a)?(T=t,tt(n)):(b=t,a)}function lr(){let t,r,e,n,o;return t=b,r=_(),t=r!==a&&(40===s.charCodeAt(b)?(e=rt,b++):(e=a,0===S&&O(et)),e!==a)&&_()!==a&&(n=(n=function(){let t,r,e,n,o,c,i,u;if(t=b,(r=I())!==a){for(e=[],n=b,o=_(),n=o!==a&&(44===s.charCodeAt(b)?(c=rr,b++):(c=a,0===S&&O(er)),c!==a)&&(i=_())!==a&&(u=I())!==a?o=[o,c,i,u]:(b=n,a);n!==a;)e.push(n),n=b,o=_(),n=o!==a&&(44===s.charCodeAt(b)?(c=rr,b++):(c=a,0===S&&O(er)),c!==a)&&(i=_())!==a&&(u=I())!==a?o=[o,c,i,u]:(b=n,a);t=e!==a?(T=t,r=M(r,e)):(b=t,a)}else b=t,t=a;return t}())===a?null:n)!==a&&_()!==a&&(41===s.charCodeAt(b)?(o=nt,b++):(o=a,0===S&&O(ot)),o!==a)?(T=t,ct(n)):(b=t,a)}function _(){let t,r;for(t=[],it.test(s.charAt(b))?(r=s.charAt(b),b++):(r=a,0===S&&O(ut));r!==a;)t.push(r),it.test(s.charAt(b))?(r=s.charAt(b),b++):(r=a,0===S&&O(ut));return t}function fr(){let t,r,e,n,o;if(t=b,r=b,Wt.test(s.charAt(b))?(e=s.charAt(b),b++):(e=a,0===S&&O(Xt)),e!==a){for(n=[],Yt.test(s.charAt(b))?(o=s.charAt(b),b++):(o=a,0===S&&O(tr));o!==a;)n.push(o),Yt.test(s.charAt(b))?(o=s.charAt(b),b++):(o=a,0===S&&O(tr));r=n!==a?e=[e,n]:(b=r,a)}else b=r,r=a;return r!==a&&(T=t,r=Z(r)),r}function I(){let t,r;return t=b,(r=(r=L())===a?P():r)!==a&&(T=t,r=o(r)),r}if((r=e())!==a&&b===s.length)return r;throw r!==a&&b<s.length&&O({type:"end"}),or(E,k<s.length?s.charAt(k):null,k<s.length?$(k,k+1):$(k,k))}const parse=peg$parse;export default parse;