import TextCompilerToken from"./TextCompilerToken";import LiteralCompilerToken from"./LiteralCompilerToken";import ExpressionCompilerToken from"./ExpressionCompilerToken";import IdentifierCompilerToken from"./IdentifierCompilerToken";import ObjectAccessCompilerToken from"./ObjectAccessCompilerToken";import ArrayAccessCompilerToken from"./ArrayAccessCompilerToken";import InvocationCompilerToken from"./InvocationCompilerToken";function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}class PeggySyntaxError extends Error{static buildMessage(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function c(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var e=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+e+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var e=t.map(c);let r,n;if(e.sort(),0<e.length){for(r=1,n=1;r<e.length;r++)e[r-1]!==e[r]&&(e[n]=e[r],n++);e.length=n}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+((t=e)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,e,r,n){super(),this.message=t,this.expected=e,this.found=r,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(r){let n="Error: "+this.message;if(this.location){let t=null,e;for(e=0;e<r.length;e++)if(r[e].grammarSource===this.location.source){t=r[e].text.split(/\r\n|\n|\r/g);break}var o,c,i,a=this.location.start,u=this.location.source+":"+a.line+":"+a.column;t?(i=this.location.end,o=peg$padEnd("",a.line.toString().length," "),c=t[a.line-1],i=a.line===i.line?i.column:c.length+1,n+="\n --\x3e "+u+"\n"+o+" |\n"+a.line+" | "+c+"\n"+o+" | "+peg$padEnd("",a.column-1," ")+peg$padEnd("",i-a.column,"^")):n+="\n at "+u}return n}}function peg$parse(u,t){const s={},R=(t=void 0!==t?t:{}).grammarSource;var e={Start:ne};let r=ne;function U(t){return new LiteralCompilerToken(t,j(),v().start.line,v().start.column)}function z(t,e){return new ExpressionCompilerToken(t,e,j(),v().start.line,v().start.column)}function Z(t){return[t[0],...t[1]].join("")}function M(t,e){return[t,...e.map(([,,,t])=>t)]}const o=function(t){return t},l="",N=function(){return[]},q=function(t){return new TextCompilerToken(j(),v().start.line,v().start.column)},c="{{",B=w("{{",!1),i="}}",D=w("}}",!1),G="@",H=w("@",!1),J=function(t,e){return new IdentifierCompilerToken(e,"@"===t,j(),v().start.line,v().start.column)},f=".",h=w(".",!1),K=function(t){return new ObjectAccessCompilerToken(t,j(),v().start.line,v().start.column)},Q="[",V=w("[",!1),W="]",X=w("]",!1),Y=function(t){return new ArrayAccessCompilerToken(t,j(),v().start.line,v().start.column)},tt="(",et=w("(",!1),rt=")",nt=w(")",!1),ot=function(t){return new InvocationCompilerToken(null!=t?t:[],j(),v().start.line,v().start.column)},n=/^[ \t\r\n]/,ct=F([" ","\t","\r","\n"],!1,!1),it={type:"any"},at="null",ut=w("null",!1),st=function(){return null},lt="NULL",ft=w("NULL",!1),ht="true",pt=w("true",!1),At=function(){return!0},mt="TRUE",gt=w("TRUE",!1),dt="false",Ct=w("false",!1),xt=function(){return!1},yt="FALSE",Tt=w("FALSE",!1),bt="0",kt=w("0",!1),Et=function(){return 0},p="-",A=w("-",!1),St=/^[1-9]/,jt=F([["1","9"]],!1,!1),m=/^[0-9]/,g=F([["0","9"]],!1,!1),vt=function(t){return parseInt([t[0],t[1],...t[2]].join(""),10)},wt=function(t){return parseFloat([t[0],t[1],t[2].join(""),".",t[4].join("")].join(""))},Ft=function(t){return parseFloat([...t.slice(0,3),...t[3]].join(""))},$t="'",Lt=w("'",!1),a="\\'",Pt=w("\\'",!1),_t=/^[^']/,It=F(["'"],!0,!1),Ot=function(t){return t.map(t=>"\\'"===t?t[1]:t).join("")},Rt='"',Ut=w('"',!1),d='\\"',zt=w('\\"',!1),Zt=/^[^"]/,Mt=F(['"'],!0,!1),Nt=function(t){return t.map(t=>'\\"'===t?t[1]:t).join("")},qt="`",Bt=w("`",!1),C="${",Dt=w("${",!1),x="\\`",Gt=w("\\`",!1),Ht=/^[^`]/,Jt=F(["`"],!0,!1),Kt=function(t){return t.map(([,t])=>"\\`"===t?t[1]:t).join("")},Qt=/^[a-zA-Z_$]/,Vt=F([["a","z"],["A","Z"],"_","$"],!1,!1),Wt=/^[a-zA-Z0-9_$]/,Xt=F([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1),Yt=",",te=w(",",!1);let y=0,T=0;const b=[{line:1,column:1}];let k=0,E=[],S=0;if(void 0!==t.startRule){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=e[t.startRule]}function j(){return u.substring(T,y)}function v(){return $(T,y)}function w(t,e){return{type:"literal",text:t,ignoreCase:e}}function F(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function ee(t){var e=b[t];let r;if(e)return e;for(r=t-1;!b[r];)r--;for(e={line:(e=b[r]).line,column:e.column};r<t;)10===u.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return b[t]=e}function $(t,e){var r=ee(t),n=ee(e);return{source:R,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function L(t){y<k||(y>k&&(k=y,E=[]),E.push(t))}function re(t,e,r){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,e),t,e,r)}function ne(){let t,e,r;if(t=y,e=[],(r=(r=ce())===s?oe():r)!==s)for(;r!==s;)e.push(r),(r=ce())===s&&(r=oe());else e=s;return e!==s&&(T=t,e=o(e)),(t=e)===s&&(t=y,(e=l)!==s&&(T=t,e=N()),t=e),t}function oe(){let t,e;return t=y,(e=function(){let t,e;t=y,u.length>y?(e=u.charAt(y),y++):(e=s,0===S&&L(it));e!==s&&(T=t,e=o(e));return t=e}())!==s&&(T=t,e=q(e)),e}function ce(){let t,e,r,n;return t=y,u.substr(y,2)===c?(e=c,y+=2):(e=s,0===S&&L(B)),t=e!==s&&I()!==s&&(r=(r=P())===s?_():r)!==s&&I()!==s&&(u.substr(y,2)===i?(n=i,y+=2):(n=s,0===S&&L(D)),n!==s)?(T=t,e=o(r)):(y=t,s)}function P(){let t,e;return t=y,(e=(e=function(){let t,e;t=y,u.substr(y,4)===at?(e=at,y+=4):(e=s,0===S&&L(ut));e!==s&&(T=t,e=st());(t=e)===s&&(t=y,u.substr(y,4)===lt?(e=lt,y+=4):(e=s,0===S&&L(ft)),e!==s&&(T=t,e=st()),t=e);return t}())===s&&(e=function(){let t,e;t=y,u.substr(y,4)===ht?(e=ht,y+=4):(e=s,0===S&&L(pt));e!==s&&(T=t,e=At());(t=e)===s&&(t=y,u.substr(y,4)===mt?(e=mt,y+=4):(e=s,0===S&&L(gt)),e!==s&&(T=t,e=At()),(t=e)===s)&&(t=y,u.substr(y,5)===dt?(e=dt,y+=5):(e=s,0===S&&L(Ct)),e!==s&&(T=t,e=xt()),(t=e)===s)&&(t=y,u.substr(y,5)===yt?(e=yt,y+=5):(e=s,0===S&&L(Tt)),e!==s&&(T=t,e=xt()),t=e);return t}())===s&&(e=function(){let t,e,r,n,o,c;t=y,39===u.charCodeAt(y)?(e=$t,y++):(e=s,0===S&&L(Lt));if(e!==s){for(r=[],u.substr(y,2)===a?(n=a,y+=2):(n=s,0===S&&L(Pt)),n===s&&(_t.test(u.charAt(y))?(n=u.charAt(y),y++):(n=s,0===S&&L(It)));n!==s;)r.push(n),u.substr(y,2)===a?(n=a,y+=2):(n=s,0===S&&L(Pt)),n===s&&(_t.test(u.charAt(y))?(n=u.charAt(y),y++):(n=s,0===S&&L(It)));t=r!==s&&(39===u.charCodeAt(y)?(n=$t,y++):(n=s,0===S&&L(Lt)),n!==s)?(T=t,e=Ot(r)):(y=t,s)}else y=t,t=s;if(t===s){if(t=y,34===u.charCodeAt(y)?(e=Rt,y++):(e=s,0===S&&L(Ut)),e!==s){for(r=[],u.substr(y,2)===d?(n=d,y+=2):(n=s,0===S&&L(zt)),n===s&&(Zt.test(u.charAt(y))?(n=u.charAt(y),y++):(n=s,0===S&&L(Mt)));n!==s;)r.push(n),u.substr(y,2)===d?(n=d,y+=2):(n=s,0===S&&L(zt)),n===s&&(Zt.test(u.charAt(y))?(n=u.charAt(y),y++):(n=s,0===S&&L(Mt)));t=r!==s&&(34===u.charCodeAt(y)?(n=Rt,y++):(n=s,0===S&&L(Ut)),n!==s)?(T=t,e=Nt(r)):(y=t,s)}else y=t,t=s;if(t===s)if(t=y,96===u.charCodeAt(y)?(e=qt,y++):(e=s,0===S&&L(Bt)),e!==s){for(r=[],n=y,o=y,S++,u.substr(y,2)===C?(c=C,y+=2):(c=s,0===S&&L(Dt)),S--,o=c===s?void 0:(y=o,s),n=o!==s&&(u.substr(y,2)===x?(c=x,y+=2):(c=s,0===S&&L(Gt)),c===s&&(Ht.test(u.charAt(y))?(c=u.charAt(y),y++):(c=s,0===S&&L(Jt))),c!==s)?o=[o,c]:(y=n,s);n!==s;)r.push(n),n=y,o=y,S++,u.substr(y,2)===C?(c=C,y+=2):(c=s,0===S&&L(Dt)),S--,o=c===s?void 0:(y=o,s),n=o!==s&&(u.substr(y,2)===x?(c=x,y+=2):(c=s,0===S&&L(Gt)),c===s&&(Ht.test(u.charAt(y))?(c=u.charAt(y),y++):(c=s,0===S&&L(Jt))),c!==s)?o=[o,c]:(y=n,s);t=r!==s&&(96===u.charCodeAt(y)?(n=qt,y++):(n=s,0===S&&L(Bt)),n!==s)?(T=t,e=Kt(r)):(y=t,s)}else y=t,t=s}return t}())===s&&(e=function(){let t,e,r,n,o,c,i,a;t=y,e=y,45===u.charCodeAt(y)?(r=p,y++):(r=s,0===S&&L(A));r===s&&(r=null);if(r!==s)if(St.test(u.charAt(y))?(n=u.charAt(y),y++):(n=s,0===S&&L(jt)),n!==s){for(o=[],m.test(u.charAt(y))?(c=u.charAt(y),y++):(c=s,0===S&&L(g));c!==s;)o.push(c),m.test(u.charAt(y))?(c=u.charAt(y),y++):(c=s,0===S&&L(g));if(o!==s)if(46===u.charCodeAt(y)?(c=f,y++):(c=s,0===S&&L(h)),c!==s){if(i=[],m.test(u.charAt(y))?(a=u.charAt(y),y++):(a=s,0===S&&L(g)),a!==s)for(;a!==s;)i.push(a),m.test(u.charAt(y))?(a=u.charAt(y),y++):(a=s,0===S&&L(g));else i=s;e=i!==s?r=[r,n,o,c,i]:(y=e,s)}else y=e,e=s;else y=e,e=s}else y=e,e=s;else y=e,e=s;e!==s&&(T=t,e=wt(e));if((t=e)===s){if(t=y,e=y,45===u.charCodeAt(y)?(r=p,y++):(r=s,0===S&&L(A)),(r=r===s?null:r)!==s)if(48===u.charCodeAt(y)?(n=bt,y++):(n=s,0===S&&L(kt)),(n=n===s?l:n)!==s)if(46===u.charCodeAt(y)?(o=f,y++):(o=s,0===S&&L(h)),o!==s){if(c=[],m.test(u.charAt(y))?(i=u.charAt(y),y++):(i=s,0===S&&L(g)),i!==s)for(;i!==s;)c.push(i),m.test(u.charAt(y))?(i=u.charAt(y),y++):(i=s,0===S&&L(g));else c=s;e=c!==s?r=[r,n,o,c]:(y=e,s)}else y=e,e=s;else y=e,e=s;else y=e,e=s;e!==s&&(T=t,e=Ft(e)),t=e}return t}())===s?function(){let t,e,r,n,o,c;t=y,48===u.charCodeAt(y)?(e=bt,y++):(e=s,0===S&&L(kt));e!==s&&(T=t,e=Et());if((t=e)===s){if(t=y,e=y,45===u.charCodeAt(y)?(r=p,y++):(r=s,0===S&&L(A)),(r=r===s?null:r)!==s)if(St.test(u.charAt(y))?(n=u.charAt(y),y++):(n=s,0===S&&L(jt)),n!==s){for(o=[],m.test(u.charAt(y))?(c=u.charAt(y),y++):(c=s,0===S&&L(g));c!==s;)o.push(c),m.test(u.charAt(y))?(c=u.charAt(y),y++):(c=s,0===S&&L(g));e=o!==s?r=[r,n,o]:(y=e,s)}else y=e,e=s;else y=e,e=s;e!==s&&(T=t,e=vt(e)),t=e}return t}():e)!==s&&(T=t,e=U(e)),e}function _(){let t,e,r,n;if(t=y,(e=function(){let t,e,r;t=y,64===u.charCodeAt(y)?(e=G,y++):(e=s,0===S&&L(H));e===s&&(e=null);t=e!==s&&(r=se(),r!==s)?(T=t,e=J(e,r)):(y=t,s);return t}())!==s){for(r=[],(n=ie())===s&&(n=ae())===s&&(n=ue());n!==s;)r.push(n),(n=ie())===s&&(n=ae())===s&&(n=ue());t=r!==s?(T=t,z(e,r)):(y=t,s)}else y=t,t=s;return t}function ie(){let t,e,r,n;return t=y,e=I(),t=e!==s&&(46===u.charCodeAt(y)?(r=f,y++):(r=s,0===S&&L(h)),r!==s)&&I()!==s&&(n=se())!==s?(T=t,K(n)):(y=t,s)}function ae(){let t,e,r,n,o;return t=y,e=I(),t=e!==s&&(91===u.charCodeAt(y)?(r=Q,y++):(r=s,0===S&&L(V)),r!==s)&&I()!==s&&(n=(n=P())===s?_():n)!==s&&I()!==s&&(93===u.charCodeAt(y)?(o=W,y++):(o=s,0===S&&L(X)),o!==s)?(T=t,Y(n)):(y=t,s)}function ue(){let t,e,r,n,o;return t=y,e=I(),t=e!==s&&(40===u.charCodeAt(y)?(r=tt,y++):(r=s,0===S&&L(et)),r!==s)&&I()!==s&&(n=(n=function(){let t,e,r,n,o,c,i,a;if(t=y,(e=O())!==s){for(r=[],n=y,o=I(),n=o!==s&&(44===u.charCodeAt(y)?(c=Yt,y++):(c=s,0===S&&L(te)),c!==s)&&(i=I())!==s&&(a=O())!==s?o=[o,c,i,a]:(y=n,s);n!==s;)r.push(n),n=y,o=I(),n=o!==s&&(44===u.charCodeAt(y)?(c=Yt,y++):(c=s,0===S&&L(te)),c!==s)&&(i=I())!==s&&(a=O())!==s?o=[o,c,i,a]:(y=n,s);t=r!==s?(T=t,e=M(e,r)):(y=t,s)}else y=t,t=s;return t}())===s?null:n)!==s&&I()!==s&&(41===u.charCodeAt(y)?(o=rt,y++):(o=s,0===S&&L(nt)),o!==s)?(T=t,ot(n)):(y=t,s)}function I(){let t,e;for(t=[],n.test(u.charAt(y))?(e=u.charAt(y),y++):(e=s,0===S&&L(ct));e!==s;)t.push(e),n.test(u.charAt(y))?(e=u.charAt(y),y++):(e=s,0===S&&L(ct));return t}function se(){let t,e,r,n,o;if(t=y,e=y,Qt.test(u.charAt(y))?(r=u.charAt(y),y++):(r=s,0===S&&L(Vt)),r!==s){for(n=[],Wt.test(u.charAt(y))?(o=u.charAt(y),y++):(o=s,0===S&&L(Xt));o!==s;)n.push(o),Wt.test(u.charAt(y))?(o=u.charAt(y),y++):(o=s,0===S&&L(Xt));e=n!==s?r=[r,n]:(y=e,s)}else y=e,e=s;return e!==s&&(T=t,e=Z(e)),e}function O(){let t,e;return t=y,(e=(e=P())===s?_():e)!==s&&(T=t,e=o(e)),e}if((e=r())!==s&&y===u.length)return e;throw e!==s&&y<u.length&&L({type:"end"}),re(E,k<u.length?u.charAt(k):null,k<u.length?$(k,k+1):$(k,k))}const parse=peg$parse;export default parse;