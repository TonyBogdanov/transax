import TextToken from"./TextToken";import LiteralToken from"./LiteralToken";import CallExpressionToken,{CallExpressionArrayAccess,CallExpressionInvocation,CallExpressionObjectAccess}from"./CallExpressionToken";const peggyParser=function(){"use strict";function fr(t,r,e,n){t=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(t,fr.prototype),t.expected=r,t.found=e,t.location=n,t.name="SyntaxError",t}function t(){this.constructor=r}var r,e;function l(t,r,e){return e=e||" ",t.length>r?t:(r-=t.length,t+(e+=e.repeat(r)).slice(0,r))}return r=fr,e=Error,t.prototype=e.prototype,r.prototype=new t,fr.prototype.format=function(t){var r="Error: "+this.message;if(this.location){for(var e=null,n=0;n<t.length;n++)if(t[n].source===this.location.source){e=t[n].text.split(/\r\n|\n|\r/g);break}var o,a,c,s=this.location.start,u=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,i=this.location.source+":"+u.line+":"+u.column;e?(c=this.location.end,o=l("",u.line.toString().length," "),a=e[s.line-1],c=(s.line===c.line?c.column:a.length+1)-s.column||1,r+="\n --\x3e "+i+"\n"+o+" |\n"+u.line+" | "+a+"\n"+o+" | "+l("",s.column-1," ")+l("",c,"^")):r+="\n at "+i}return r},fr.buildMessage=function(t,r){var e={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var r=t.parts.map(function(t){return Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t)});return"["+(t.inverted?"^":"")+r.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function c(t){return e[t.type](t)}return"Expected "+function(t){var r,e,n=t.map(c);if(n.sort(),0<n.length){for(e=r=1;r<n.length;r++)n[r-1]!==n[r]&&(n[e]=n[r],e++);n.length=e}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+((t=r)?'"'+o(t)+'"':"end of input")+" found."},{SyntaxError:fr,parse:function(l,t){function z(t,r){return[t,...r.map(([,,,t])=>t)]}function Z(t){return[t[0],...t[1]].join("")}function _(t){return t.map(t=>-1<["\\'","\\\\"].indexOf(t)?t[1]:t).join("")}function I(t){return t.map(t=>-1<['\\"',"\\\\"].indexOf(t)?t[1]:t).join("")}function M(t){return t.map(([,t])=>-1<["\\`","\\\\"].indexOf(t)?t[1]:t).join("")}var h={},a=(t=void 0!==t?t:{}).grammarSource,r={Start:nr},N=nr,q="{{",B="}}",u="(",i=")",D="@",f=".",G="[",H="]",J=",",K="null",Q="NULL",V="true",W="TRUE",X="false",Y="FALSE",tt="'",c="\\'",s="\\\\",rt='"',A='\\"',et="`",p="${",d="\\`",nt="0",g="e",ot=/^[ \t\r\n]/,at=/^[a-zA-Z_$]/,C=/^[a-zA-Z0-9_$]/,ct=/^[^']/,st=/^[^"]/,ut=/^[^`]/,x=/^[0-9]/,v=/^[+\-]/,it=/^[1-9]/,lt=O("{{",!1),ht=O("}}",!1),ft={type:"any"},b=O("(",!1),y=O(")",!1),At=O("@",!1),m=O(".",!1),pt=O("[",!1),dt=O("]",!1),gt=O(",",!1),Ct=P([" ","\t","\r","\n"],!1,!1),xt=P([["a","z"],["A","Z"],"_","$"],!1,!1),E=P([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1),vt=O("null",!1),bt=O("NULL",!1),yt=O("true",!1),mt=O("TRUE",!1),Et=O("false",!1),wt=O("FALSE",!1),Tt=O("'",!1),Lt=O("\\'",!1),w=O("\\\\",!1),kt=P(["'"],!0,!1),Ft=O('"',!1),St=O('\\"',!1),jt=P(['"'],!0,!1),Ot=O("`",!1),Pt=O("${",!1),Rt=O("\\`",!1),$t=P(["`"],!0,!1),T=P([["0","9"]],!1,!1),L=P(["+","-"],!1,!1),Ut=O("0",!1),zt=P([["1","9"]],!1,!1),Zt=O("e",!0),_t=function(t){return t},It=function(){return[]},Mt=function(t){return t},Nt=function(){return new TextToken(o(),j())},qt=function(t,r,e){return new CallExpressionObjectAccess(e)},Bt=function(t,r,e){return new CallExpressionArrayAccess(e)},Dt=function(t,r,e){return new CallExpressionInvocation(null!=e?e:[])},Gt=function(t,r,e){return new CallExpressionToken("@"===t,r,e,o(),j())},Ht=function(t){return new LiteralToken(t,o(),j())},Jt=function(t){return new LiteralToken(t,o(),j())},Kt=function(t){return new LiteralToken(t,o(),j())},Qt=function(t){return new LiteralToken(t,o(),j())},Vt=function(){return parseFloat(o())},Wt=function(){return parseFloat(o())},Xt=function(){return parseFloat(o())},k=0,F=0,n=[{line:1,column:1}],e=0,Yt=[],S=0;if("startRule"in t){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');N=r[t.startRule]}function o(){return l.substring(F,k)}function j(){return rr(F,k)}function O(t,r){return{type:"literal",text:t,ignoreCase:r}}function P(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function tr(t){var r,e=n[t];if(e)return e;for(r=t-1;!n[r];)r--;for(e={line:(e=n[r]).line,column:e.column};r<t;)10===l.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return n[t]=e}function rr(t,r,e){var n=tr(t),o=tr(r),t={source:a,start:{offset:t,line:n.line,column:n.column},end:{offset:r,line:o.line,column:o.column}};return e&&a&&"function"==typeof a.offset&&(t.start=a.offset(t.start),t.end=a.offset(t.end)),t}function R(t){k<e||(e<k&&(e=k,Yt=[]),Yt.push(t))}function er(t,r,e){return new fr(fr.buildMessage(t,r),t,r,e)}function nr(){var t=k,r=[],e=or();if((e=e===h?ar():e)!==h)for(;e!==h;)r.push(e),(e=or())===h&&(e=ar());else r=h;return r!==h&&(F=t,r=_t(r)),(t=r)===h&&(r="",F=t=k,t=r=It()),t}function or(){var t,r,e=k;return l.substr(k,2)===q?(t=q,k+=2):(t=h,0===S&&R(lt)),e=t!==h&&(U(),(t=$())!==h)&&(U(),l.substr(k,2)===B?(r=B,k+=2):(r=h,0===S&&R(ht)),r!==h)?(F=e,Mt(t)):(k=e,h)}function ar(){var t,r=k;return l.length>k?(t=l.charAt(k),k++):(t=h,0===S&&R(ft)),t!==h&&(F=r,t=Nt()),t}function $(){var t,r,e,n=k;return 40===l.charCodeAt(k)?(t=u,k++):(t=h,0===S&&R(b)),n=(n=t!==h&&(U(),(r=cr())!==h)&&(U(),41===l.charCodeAt(k)?(e=i,k++):(e=h,0===S&&R(y)),e!==h)?(F=n,r):(k=n,h))===h&&(n=cr())===h&&(n=k,40===l.charCodeAt(k)?(t=u,k++):(t=h,0===S&&R(b)),(n=t!==h&&(U(),(r=ur())!==h)&&(U(),41===l.charCodeAt(k)?(e=i,k++):(e=h,0===S&&R(y)),e!==h)?(F=n,r):(k=n,h))===h)?ur():n}function cr(){var t,r,e,n,o,a,c,s=k;if(64===l.charCodeAt(k)?(t=D,k++):(t=h,0===S&&R(At)),t===h&&(t=null),(r=ir())!==h){for(e=[],n=k,U(),46===l.charCodeAt(k)?(o=f,k++):(o=h,0===S&&R(m)),(n=o!==h&&(U(),(a=ir())!==h)?(F=n,qt(t,r,a)):(k=n,h))===h&&(n=k,U(),91===l.charCodeAt(k)?(o=G,k++):(o=h,0===S&&R(pt)),(n=o!==h&&(U(),(a=$())!==h)&&(U(),93===l.charCodeAt(k)?(c=H,k++):(c=h,0===S&&R(dt)),c!==h)?(F=n,Bt(t,r,a)):(k=n,h))===h)&&(n=k,U(),40===l.charCodeAt(k)?(o=u,k++):(o=h,0===S&&R(b)),n=o!==h&&(U(),(a=sr())===h&&(a=null),U(),41===l.charCodeAt(k)?(c=i,k++):(c=h,0===S&&R(y)),c!==h)?(F=n,Dt(t,r,a)):(k=n,h));n!==h;)e.push(n),n=k,U(),46===l.charCodeAt(k)?(o=f,k++):(o=h,0===S&&R(m)),(n=o!==h&&(U(),(a=ir())!==h)?(F=n,qt(t,r,a)):(k=n,h))===h&&(n=k,U(),91===l.charCodeAt(k)?(o=G,k++):(o=h,0===S&&R(pt)),(n=o!==h&&(U(),(a=$())!==h)&&(U(),93===l.charCodeAt(k)?(c=H,k++):(c=h,0===S&&R(dt)),c!==h)?(F=n,Bt(t,r,a)):(k=n,h))===h)&&(n=k,U(),40===l.charCodeAt(k)?(o=u,k++):(o=h,0===S&&R(b)),n=o!==h&&(U(),(a=sr())===h&&(a=null),U(),41===l.charCodeAt(k)?(c=i,k++):(c=h,0===S&&R(y)),c!==h)?(F=n,Dt(t,r,a)):(k=n,h));F=s,s=Gt(t,r,e)}else k=s,s=h;return s}function sr(){var t,r,e,n,o,a,c=k,s=$();if(s!==h){for(t=[],r=k,e=U(),44===l.charCodeAt(k)?(n=J,k++):(n=h,0===S&&R(gt)),r=n!==h&&(o=U(),(a=$())!==h)?e=[e,n,o,a]:(k=r,h);r!==h;)t.push(r),r=k,e=U(),44===l.charCodeAt(k)?(n=J,k++):(n=h,0===S&&R(gt)),r=n!==h&&(o=U(),(a=$())!==h)?e=[e,n,o,a]:(k=r,h);F=c,c=z(s,t)}else k=c,c=h;return c}function ur(){var t=k,r=lr();return r!==h&&(F=t,r=Ht(r)),(t=r)===h&&(t=k,(r=hr())!==h&&(F=t,r=Jt(r)),(t=r)===h)&&(t=k,(r=function(){var t,r,e,n;t=k,t=(r=function(){var t,r,e,n,o,a,c,s,u,i;t=k,v.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===S&&R(L));r===h&&(r=null);48===l.charCodeAt(k)?(e=nt,k++):(e=h,0===S&&R(Ut));if(e===h)if(e=k,it.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(zt)),n!==h){for(o=[],x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R(T));a!==h;)o.push(a),x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R(T));e=n=[n,o]}else k=e,e=h;if(e!==h)if(46===l.charCodeAt(k)?(n=f,k++):(n=h,0===S&&R(m)),n!==h){for(o=[],x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R(T));a!==h;)o.push(a),x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R(T));if(a=k,l.substr(k,1).toLowerCase()===g?(c=l.charAt(k),k++):(c=h,0===S&&R(Zt)),c!==h){if(v.test(l.charAt(k))?(s=l.charAt(k),k++):(s=h,0===S&&R(L)),s===h&&(s=null),u=[],x.test(l.charAt(k))?(i=l.charAt(k),k++):(i=h,0===S&&R(T)),i!==h)for(;i!==h;)u.push(i),x.test(l.charAt(k))?(i=l.charAt(k),k++):(i=h,0===S&&R(T));else u=h;a=u!==h?c=[c,s,u]:(k=a,h)}else k=a,a=h;a===h&&(a=null),F=t,t=Vt()}else k=t,t=h;else k=t,t=h;if(t===h){if(t=k,v.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===S&&R(L)),r===h&&(r=null),46===l.charCodeAt(k)?(e=f,k++):(e=h,0===S&&R(m)),e!==h){if(n=[],x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===S&&R(T)),o!==h)for(;o!==h;)n.push(o),x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===S&&R(T));else n=h;if(n!==h){if(o=k,l.substr(k,1).toLowerCase()===g?(a=l.charAt(k),k++):(a=h,0===S&&R(Zt)),a!==h){if(v.test(l.charAt(k))?(c=l.charAt(k),k++):(c=h,0===S&&R(L)),c===h&&(c=null),s=[],x.test(l.charAt(k))?(u=l.charAt(k),k++):(u=h,0===S&&R(T)),u!==h)for(;u!==h;)s.push(u),x.test(l.charAt(k))?(u=l.charAt(k),k++):(u=h,0===S&&R(T));else s=h;o=s!==h?a=[a,c,s]:(k=o,h)}else k=o,o=h;o===h&&(o=null),F=t,t=Wt()}else k=t,t=h}else k=t,t=h;if(t===h){if(t=k,v.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===S&&R(L)),r===h&&(r=null),48===l.charCodeAt(k)?(e=nt,k++):(e=h,0===S&&R(Ut)),e===h)if(e=k,it.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(zt)),n!==h){for(o=[],x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R(T));a!==h;)o.push(a),x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R(T));e=n=[n,o]}else k=e,e=h;if(e!==h){if(n=k,l.substr(k,1).toLowerCase()===g?(o=l.charAt(k),k++):(o=h,0===S&&R(Zt)),o!==h){if(v.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R(L)),a===h&&(a=null),c=[],x.test(l.charAt(k))?(s=l.charAt(k),k++):(s=h,0===S&&R(T)),s!==h)for(;s!==h;)c.push(s),x.test(l.charAt(k))?(s=l.charAt(k),k++):(s=h,0===S&&R(T));else c=h;n=c!==h?o=[o,a,c]:(k=n,h)}else k=n,n=h;n===h&&(n=null),F=t,t=Xt()}else k=t,t=h}}return t}())!==h&&(e=k,S++,at.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(xt)),n===h&&(x.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(T))),S--,e=n===h?void 0:(k=e,h),e!==h)?(F=t,r):(k=t,h);return t}())!==h&&(F=t,r=Kt(r)),(t=r)===h)&&(t=k,(r=function(){var t,r,e,n,o,a;t=k,39===l.charCodeAt(k)?(r=tt,k++):(r=h,0===S&&R(Tt));if(r!==h){for(e=[],l.substr(k,2)===c?(n=c,k+=2):(n=h,0===S&&R(Lt)),n===h&&(l.substr(k,2)===s?(n=s,k+=2):(n=h,0===S&&R(w)),n===h)&&(ct.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(kt)));n!==h;)e.push(n),l.substr(k,2)===c?(n=c,k+=2):(n=h,0===S&&R(Lt)),n===h&&(l.substr(k,2)===s?(n=s,k+=2):(n=h,0===S&&R(w)),n===h)&&(ct.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(kt)));39===l.charCodeAt(k)?(n=tt,k++):(n=h,0===S&&R(Tt)),t=n!==h?(F=t,_(e)):(k=t,h)}else k=t,t=h;if(t===h){if(t=k,34===l.charCodeAt(k)?(r=rt,k++):(r=h,0===S&&R(Ft)),r!==h){for(e=[],l.substr(k,2)===A?(n=A,k+=2):(n=h,0===S&&R(St)),n===h&&(l.substr(k,2)===s?(n=s,k+=2):(n=h,0===S&&R(w)),n===h)&&(st.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(jt)));n!==h;)e.push(n),l.substr(k,2)===A?(n=A,k+=2):(n=h,0===S&&R(St)),n===h&&(l.substr(k,2)===s?(n=s,k+=2):(n=h,0===S&&R(w)),n===h)&&(st.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(jt)));34===l.charCodeAt(k)?(n=rt,k++):(n=h,0===S&&R(Ft)),t=n!==h?(F=t,I(e)):(k=t,h)}else k=t,t=h;if(t===h)if(t=k,96===l.charCodeAt(k)?(r=et,k++):(r=h,0===S&&R(Ot)),r!==h){for(e=[],o=n=k,S++,l.substr(k,2)===p?(a=p,k+=2):(a=h,0===S&&R(Pt)),S--,o=a===h?void 0:(k=o,h),n=o!==h&&(l.substr(k,2)===d?(a=d,k+=2):(a=h,0===S&&R(Rt)),a===h&&(l.substr(k,2)===s?(a=s,k+=2):(a=h,0===S&&R(w)),a===h)&&(ut.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R($t))),a!==h)?o=[o,a]:(k=n,h);n!==h;)e.push(n),o=n=k,S++,l.substr(k,2)===p?(a=p,k+=2):(a=h,0===S&&R(Pt)),S--,o=a===h?void 0:(k=o,h),n=o!==h&&(l.substr(k,2)===d?(a=d,k+=2):(a=h,0===S&&R(Rt)),a===h&&(l.substr(k,2)===s?(a=s,k+=2):(a=h,0===S&&R(w)),a===h)&&(ut.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===S&&R($t))),a!==h)?o=[o,a]:(k=n,h);96===l.charCodeAt(k)?(n=et,k++):(n=h,0===S&&R(Ot)),t=n!==h?(F=t,M(e)):(k=t,h)}else k=t,t=h}return t}())!==h&&(F=t,r=Qt(r)),t=r),t}function U(){var t,r=[];for(ot.test(l.charAt(k))?(t=l.charAt(k),k++):(t=h,0===S&&R(Ct));t!==h;)r.push(t),ot.test(l.charAt(k))?(t=l.charAt(k),k++):(t=h,0===S&&R(Ct));return r}function ir(){var t,r,e,n,o=k,a=k;if(S++,t=function(){var t;(t=lr())===h&&(t=hr());return t}(),S--,(a=t===h?void 0:(k=a,h))!==h){if(t=k,at.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===S&&R(xt)),r!==h){for(e=[],C.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(E));n!==h;)e.push(n),C.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===S&&R(E));t=r=[r,e]}else k=t,t=h;o=t!==h?(F=o,Z(t)):(k=o,h)}else k=o,o=h;return o}function lr(){var t,r,e,n=k;return l.substr(k,4)===K?(t=K,k+=4):(t=h,0===S&&R(vt)),(n=t!==h&&(r=k,S++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===S&&R(E)),S--,(r=e===h?void 0:(k=r,h))!==h)?(F=n,null):(k=n,h))===h&&(n=k,l.substr(k,4)===Q?(t=Q,k+=4):(t=h,0===S&&R(bt)),n=t!==h&&(r=k,S++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===S&&R(E)),S--,(r=e===h?void 0:(k=r,h))!==h)?(F=n,null):(k=n,h)),n}function hr(){var t,r,e,n=k;return l.substr(k,4)===V?(t=V,k+=4):(t=h,0===S&&R(yt)),(n=t!==h&&(r=k,S++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===S&&R(E)),S--,(r=e===h?void 0:(k=r,h))!==h)?(F=n,!0):(k=n,h))===h&&(n=k,l.substr(k,4)===W?(t=W,k+=4):(t=h,0===S&&R(mt)),(n=t!==h&&(r=k,S++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===S&&R(E)),S--,(r=e===h?void 0:(k=r,h))!==h)?(F=n,!0):(k=n,h))===h)&&(n=k,l.substr(k,5)===X?(t=X,k+=5):(t=h,0===S&&R(Et)),(n=t!==h&&(r=k,S++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===S&&R(E)),S--,(r=e===h?void 0:(k=r,h))!==h)?(F=n,!1):(k=n,h))===h)&&(n=k,l.substr(k,5)===Y?(t=Y,k+=5):(t=h,0===S&&R(wt)),n=t!==h&&(r=k,S++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===S&&R(E)),S--,(r=e===h?void 0:(k=r,h))!==h)?(F=n,!1):(k=n,h)),n}if((r=N())!==h&&k===l.length)return r;throw r!==h&&k<l.length&&R({type:"end"}),er(Yt,e<l.length?l.charAt(e):null,e<l.length?rr(e,e+1):rr(e,e))}}}(),parse=(peggyParser.SyntaxError.prototype.name="PeggySyntaxError",peggyParser.parse),PeggySyntaxError=peggyParser.SyntaxError;export default parse;