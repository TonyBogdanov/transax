"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const TextToken_1=require("./TextToken.cjs"),CompilerContext_1=require("./CompilerContext.cjs"),TernaryExpressionToken_1=require("./TernaryExpressionToken.cjs"),ComparisonExpressionToken_1=require("./ComparisonExpressionToken.cjs"),CompilerOptions_1=require("./CompilerOptions.cjs"),peg_1=require("./peg.cjs");class Compiler{constructor(e={}){this.options=e instanceof CompilerOptions_1.default?e:new CompilerOptions_1.default(e)}tokenize(e){var o=[];for(const t of(0,peg_1.default)(e))0<o.length&&t instanceof TextToken_1.default&&o[o.length-1]instanceof TextToken_1.default?o[o.length-1].text+=t.text:o.push(t);return o}compile(e){this.options.logger.verbose(`Compiling: ${e}.`);var o=new CompilerContext_1.default,t=['""'];for(const i of this.tokenize(e)){var n=i instanceof TernaryExpressionToken_1.default||i instanceof ComparisonExpressionToken_1.default,r=i.compile(o);t.push(n?`(${r})`:r)}for(let e=0;e<t.length;e++)["null","true","false"].includes(t[e])&&(t[e]='""');for(let e=1;e<t.length;e++)t[e-1].startsWith('"')&&t[e-1].endsWith('"')&&t[e].startsWith('"')&&(t[e-1]=t[e-1].slice(0,-1)+t[e].slice(1),t.splice(e,1),e--);let s="";return 0<o.parameters.length&&(s+=`{${o.parameters.join(",")}}`),0<o.globals.length&&(0===o.parameters.length&&(s+="_"),s+=`,{${o.globals.join(",")}}`),""===s?t.join("+"):`(${s})=>`+t.join("+")}}exports.default=Compiler;