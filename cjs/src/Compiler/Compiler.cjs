"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Logger_1=require("../Logger/Logger"),TextToken_1=require("./TextToken"),CompilerContext_1=require("./CompilerContext"),peg_1=require("./peg"),TernaryExpressionToken_1=require("./TernaryExpressionToken"),ComparisonExpressionToken_1=require("./ComparisonExpressionToken");class Options{constructor(e={}){this.logger=null!=(e=e.logger)?e:new Logger_1.default({namespace:"TRANSAX:COMPILER"})}}class Compiler{constructor(e={}){this.options=new Options(e)}tokenize(e){var o=[];for(const t of(0,peg_1.default)(e))0<o.length&&t instanceof TextToken_1.default&&o[o.length-1]instanceof TextToken_1.default?o[o.length-1].text+=t.text:o.push(t);return o}compile(e){var o=new CompilerContext_1.default,t=['""'];for(const i of this.tokenize(e)){var r=i instanceof TernaryExpressionToken_1.default||i instanceof ComparisonExpressionToken_1.default,n=i.compile(o);t.push(r?`(${n})`:n)}for(let e=0;e<t.length;e++)["null","true","false"].includes(t[e])&&(t[e]='""');for(let e=1;e<t.length;e++)t[e-1].startsWith('"')&&t[e-1].endsWith('"')&&t[e].startsWith('"')&&(t[e-1]=t[e-1].slice(0,-1)+t[e].slice(1),t.splice(e,1),e--);let s="";return 0<o.parameters.length&&(s+=`{${o.parameters.join(",")}}`),0<o.globals.length&&(0===o.parameters.length&&(s+="_"),s+=`,{${o.globals.join(",")}}`),""===s?t.join("+"):`(${s})=>`+t.join("+")}}exports.default=Compiler;