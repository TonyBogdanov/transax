"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const TextCompilerToken_1=require("./TextCompilerToken"),LiteralCompilerToken_1=require("./LiteralCompilerToken"),ExpressionCompilerToken_1=require("./ExpressionCompilerToken"),IdentifierCompilerToken_1=require("./IdentifierCompilerToken"),ObjectAccessCompilerToken_1=require("./ObjectAccessCompilerToken"),ArrayAccessCompilerToken_1=require("./ArrayAccessCompilerToken");function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}class PeggySyntaxError extends Error{static buildMessage(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function c(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var e=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+e+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var e=t.map(c);let r,n;if(e.sort(),0<e.length){for(r=1,n=1;r<e.length;r++)e[r-1]!==e[r]&&(e[n]=e[r],n++);e.length=n}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+((t=e)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,e,r,n){super(),this.message=t,this.expected=e,this.found=r,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(r){let n="Error: "+this.message;if(this.location){let t=null,e;for(e=0;e<r.length;e++)if(r[e].grammarSource===this.location.source){t=r[e].text.split(/\r\n|\n|\r/g);break}var o,c,u,a=this.location.start,s=this.location.source+":"+a.line+":"+a.column;t?(u=this.location.end,o=peg$padEnd("",a.line.toString().length," "),c=t[a.line-1],u=a.line===u.line?u.column:c.length+1,n+="\n --\x3e "+s+"\n"+o+" |\n"+a.line+" | "+c+"\n"+o+" | "+peg$padEnd("",a.column-1," ")+peg$padEnd("",u-a.column,"^")):n+="\n at "+s}return n}}function peg$parse(s,t){const i={},R=(t=void 0!==t?t:{}).grammarSource;var e={Start:Ht};let r=Ht;function U(t){return new LiteralCompilerToken_1.default(t,w(),F().start.line,F().start.column)}function z(t,e){return new ExpressionCompilerToken_1.default(t,e,w(),F().start.line,F().start.column)}function I(t){return[t[0],...t[1]].join("")}const o=function(t){return t},l="",Z=function(){return[]},M=function(t){return new TextCompilerToken_1.default(w(),F().start.line,F().start.column)},c="{{",N=$("{{",!1),u="}}",B=$("}}",!1),D="@",G=$("@",!1),H=function(t,e){return new IdentifierCompilerToken_1.default(e,"@"===t,w(),F().start.line,F().start.column)},f=".",h=$(".",!1),J=function(t){return new ObjectAccessCompilerToken_1.default(t,w(),F().start.line,F().start.column)},K="[",Q=$("[",!1),V="]",W=$("]",!1),X=function(t){return new ArrayAccessCompilerToken_1.default(t,w(),F().start.line,F().start.column)},n=/^[ \t\r\n]/,a=P([" ","\t","\r","\n"],!1,!1),Y={type:"any"},p="null",tt=$("null",!1),A=function(){return null},et="NULL",rt=$("NULL",!1),nt="true",ot=$("true",!1),ct=function(){return!0},ut="TRUE",at=$("TRUE",!1),st="false",it=$("false",!1),lt=function(){return!1},ft="FALSE",ht=$("FALSE",!1),pt="0",At=$("0",!1),gt=function(){return 0},g="-",d=$("-",!1),dt=/^[1-9]/,mt=P([["1","9"]],!1,!1),m=/^[0-9]/,C=P([["0","9"]],!1,!1),Ct=function(t){return parseInt([t[0],t[1],...t[2]].join(""),10)},xt=function(t){return parseFloat([t[0],t[1],t[2].join(""),".",t[4].join("")].join(""))},yt=function(t){return parseFloat([...t.slice(0,3),...t[3]].join(""))},bt="'",Tt=$("'",!1),x="\\'",Et=$("\\'",!1),_t=/^[^']/,kt=P(["'"],!0,!1),jt=function(t){return t.map(t=>"\\'"===t?t[1]:t).join("")},St='"',vt=$('"',!1),y='\\"',wt=$('\\"',!1),Ft=/^[^"]/,$t=P(['"'],!0,!1),Pt=function(t){return t.map(t=>'\\"'===t?t[1]:t).join("")},Lt="`",Ot=$("`",!1),b="${",qt=$("${",!1),T="\\`",Rt=$("\\`",!1),Ut=/^[^`]/,zt=P(["`"],!0,!1),It=function(t){return t.map(([,t])=>"\\`"===t?t[1]:t).join("")},Zt=/^[a-zA-Z_$]/,Mt=P([["a","z"],["A","Z"],"_","$"],!1,!1),Nt=/^[a-zA-Z0-9_$]/,Bt=P([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1);let E=0,_=0;const k=[{line:1,column:1}];let j=0,S=[],v=0;if(void 0!==t.startRule){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=e[t.startRule]}function w(){return s.substring(_,E)}function F(){return L(_,E)}function $(t,e){return{type:"literal",text:t,ignoreCase:e}}function P(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Dt(t){var e=k[t];let r;if(e)return e;for(r=t-1;!k[r];)r--;for(e={line:(e=k[r]).line,column:e.column};r<t;)10===s.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return k[t]=e}function L(t,e){var r=Dt(t),n=Dt(e);return{source:R,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function O(t){E<j||(E>j&&(j=E,S=[]),S.push(t))}function Gt(t,e,r){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,e),t,e,r)}function Ht(){let t,e,r;if(t=E,e=[],(r=(r=Kt())===i?Jt():r)!==i)for(;r!==i;)e.push(r),(r=Kt())===i&&(r=Jt());else e=i;return e!==i&&(_=t,e=o(e)),(t=e)===i&&(t=E,(e=l)!==i&&(_=t,e=Z()),t=e),t}function Jt(){let t,e;return t=E,(e=function(){let t,e;t=E,s.length>E?(e=s.charAt(E),E++):(e=i,0===v&&O(Y));e!==i&&(_=t,e=o(e));return t=e}())!==i&&(_=t,e=M(e)),e}function Kt(){let t,e,r,n;return t=E,s.substr(E,2)===c?(e=c,E+=2):(e=i,0===v&&O(N)),t=e!==i&&q()!==i&&(r=(r=Qt())===i?Vt():r)!==i&&q()!==i&&(s.substr(E,2)===u?(n=u,E+=2):(n=i,0===v&&O(B)),n!==i)?(_=t,e=o(r)):(E=t,i)}function Qt(){let t,e;return t=E,(e=(e=function(){let t,e;t=E,s.substr(E,4)===p?(e=p,E+=4):(e=i,0===v&&O(tt));e!==i&&(_=t,e=A());(t=e)===i&&(t=E,s.substr(E,4)===et?(e=et,E+=4):(e=i,0===v&&O(rt)),e!==i&&(_=t,e=A()),t=e);return t}())===i&&(e=function(){let t,e;t=E,s.substr(E,4)===nt?(e=nt,E+=4):(e=i,0===v&&O(ot));e!==i&&(_=t,e=ct());(t=e)===i&&(t=E,s.substr(E,4)===ut?(e=ut,E+=4):(e=i,0===v&&O(at)),e!==i&&(_=t,e=ct()),(t=e)===i)&&(t=E,s.substr(E,5)===st?(e=st,E+=5):(e=i,0===v&&O(it)),e!==i&&(_=t,e=lt()),(t=e)===i)&&(t=E,s.substr(E,5)===ft?(e=ft,E+=5):(e=i,0===v&&O(ht)),e!==i&&(_=t,e=lt()),t=e);return t}())===i&&(e=function(){let t,e,r,n,o,c;t=E,39===s.charCodeAt(E)?(e=bt,E++):(e=i,0===v&&O(Tt));if(e!==i){for(r=[],s.substr(E,2)===x?(n=x,E+=2):(n=i,0===v&&O(Et)),n===i&&(_t.test(s.charAt(E))?(n=s.charAt(E),E++):(n=i,0===v&&O(kt)));n!==i;)r.push(n),s.substr(E,2)===x?(n=x,E+=2):(n=i,0===v&&O(Et)),n===i&&(_t.test(s.charAt(E))?(n=s.charAt(E),E++):(n=i,0===v&&O(kt)));t=r!==i&&(39===s.charCodeAt(E)?(n=bt,E++):(n=i,0===v&&O(Tt)),n!==i)?(_=t,e=jt(r)):(E=t,i)}else E=t,t=i;if(t===i){if(t=E,34===s.charCodeAt(E)?(e=St,E++):(e=i,0===v&&O(vt)),e!==i){for(r=[],s.substr(E,2)===y?(n=y,E+=2):(n=i,0===v&&O(wt)),n===i&&(Ft.test(s.charAt(E))?(n=s.charAt(E),E++):(n=i,0===v&&O($t)));n!==i;)r.push(n),s.substr(E,2)===y?(n=y,E+=2):(n=i,0===v&&O(wt)),n===i&&(Ft.test(s.charAt(E))?(n=s.charAt(E),E++):(n=i,0===v&&O($t)));t=r!==i&&(34===s.charCodeAt(E)?(n=St,E++):(n=i,0===v&&O(vt)),n!==i)?(_=t,e=Pt(r)):(E=t,i)}else E=t,t=i;if(t===i)if(t=E,96===s.charCodeAt(E)?(e=Lt,E++):(e=i,0===v&&O(Ot)),e!==i){for(r=[],n=E,o=E,v++,s.substr(E,2)===b?(c=b,E+=2):(c=i,0===v&&O(qt)),v--,o=c===i?void 0:(E=o,i),n=o!==i&&(s.substr(E,2)===T?(c=T,E+=2):(c=i,0===v&&O(Rt)),c===i&&(Ut.test(s.charAt(E))?(c=s.charAt(E),E++):(c=i,0===v&&O(zt))),c!==i)?o=[o,c]:(E=n,i);n!==i;)r.push(n),n=E,o=E,v++,s.substr(E,2)===b?(c=b,E+=2):(c=i,0===v&&O(qt)),v--,o=c===i?void 0:(E=o,i),n=o!==i&&(s.substr(E,2)===T?(c=T,E+=2):(c=i,0===v&&O(Rt)),c===i&&(Ut.test(s.charAt(E))?(c=s.charAt(E),E++):(c=i,0===v&&O(zt))),c!==i)?o=[o,c]:(E=n,i);t=r!==i&&(96===s.charCodeAt(E)?(n=Lt,E++):(n=i,0===v&&O(Ot)),n!==i)?(_=t,e=It(r)):(E=t,i)}else E=t,t=i}return t}())===i&&(e=function(){let t,e,r,n,o,c,u,a;t=E,e=E,45===s.charCodeAt(E)?(r=g,E++):(r=i,0===v&&O(d));r===i&&(r=null);if(r!==i)if(dt.test(s.charAt(E))?(n=s.charAt(E),E++):(n=i,0===v&&O(mt)),n!==i){for(o=[],m.test(s.charAt(E))?(c=s.charAt(E),E++):(c=i,0===v&&O(C));c!==i;)o.push(c),m.test(s.charAt(E))?(c=s.charAt(E),E++):(c=i,0===v&&O(C));if(o!==i)if(46===s.charCodeAt(E)?(c=f,E++):(c=i,0===v&&O(h)),c!==i){if(u=[],m.test(s.charAt(E))?(a=s.charAt(E),E++):(a=i,0===v&&O(C)),a!==i)for(;a!==i;)u.push(a),m.test(s.charAt(E))?(a=s.charAt(E),E++):(a=i,0===v&&O(C));else u=i;e=u!==i?r=[r,n,o,c,u]:(E=e,i)}else E=e,e=i;else E=e,e=i}else E=e,e=i;else E=e,e=i;e!==i&&(_=t,e=xt(e));if((t=e)===i){if(t=E,e=E,45===s.charCodeAt(E)?(r=g,E++):(r=i,0===v&&O(d)),(r=r===i?null:r)!==i)if(48===s.charCodeAt(E)?(n=pt,E++):(n=i,0===v&&O(At)),(n=n===i?l:n)!==i)if(46===s.charCodeAt(E)?(o=f,E++):(o=i,0===v&&O(h)),o!==i){if(c=[],m.test(s.charAt(E))?(u=s.charAt(E),E++):(u=i,0===v&&O(C)),u!==i)for(;u!==i;)c.push(u),m.test(s.charAt(E))?(u=s.charAt(E),E++):(u=i,0===v&&O(C));else c=i;e=c!==i?r=[r,n,o,c]:(E=e,i)}else E=e,e=i;else E=e,e=i;else E=e,e=i;e!==i&&(_=t,e=yt(e)),t=e}return t}())===i?function(){let t,e,r,n,o,c;t=E,48===s.charCodeAt(E)?(e=pt,E++):(e=i,0===v&&O(At));e!==i&&(_=t,e=gt());if((t=e)===i){if(t=E,e=E,45===s.charCodeAt(E)?(r=g,E++):(r=i,0===v&&O(d)),(r=r===i?null:r)!==i)if(dt.test(s.charAt(E))?(n=s.charAt(E),E++):(n=i,0===v&&O(mt)),n!==i){for(o=[],m.test(s.charAt(E))?(c=s.charAt(E),E++):(c=i,0===v&&O(C));c!==i;)o.push(c),m.test(s.charAt(E))?(c=s.charAt(E),E++):(c=i,0===v&&O(C));e=o!==i?r=[r,n,o]:(E=e,i)}else E=e,e=i;else E=e,e=i;e!==i&&(_=t,e=Ct(e)),t=e}return t}():e)!==i&&(_=t,e=U(e)),e}function Vt(){let t,e,r,n;if(t=E,(e=function(){let t,e,r;t=E,64===s.charCodeAt(E)?(e=D,E++):(e=i,0===v&&O(G));e===i&&(e=null);t=e!==i&&(r=Yt(),r!==i)?(_=t,e=H(e,r)):(E=t,i);return t}())!==i){for(r=[],(n=Wt())===i&&(n=Xt());n!==i;)r.push(n),(n=Wt())===i&&(n=Xt());t=r!==i?(_=t,z(e,r)):(E=t,i)}else E=t,t=i;return t}function Wt(){let t,e,r,n;return t=E,e=q(),t=e!==i&&(46===s.charCodeAt(E)?(r=f,E++):(r=i,0===v&&O(h)),r!==i)&&q()!==i&&(n=Yt())!==i?(_=t,J(n)):(E=t,i)}function Xt(){let t,e,r,n,o;return t=E,e=q(),t=e!==i&&(91===s.charCodeAt(E)?(r=K,E++):(r=i,0===v&&O(Q)),r!==i)&&q()!==i&&(n=(n=Qt())===i?Vt():n)!==i&&q()!==i&&(93===s.charCodeAt(E)?(o=V,E++):(o=i,0===v&&O(W)),o!==i)?(_=t,X(n)):(E=t,i)}function q(){let t,e;for(t=[],n.test(s.charAt(E))?(e=s.charAt(E),E++):(e=i,0===v&&O(a));e!==i;)t.push(e),n.test(s.charAt(E))?(e=s.charAt(E),E++):(e=i,0===v&&O(a));return t}function Yt(){let t,e,r,n,o;if(t=E,e=E,Zt.test(s.charAt(E))?(r=s.charAt(E),E++):(r=i,0===v&&O(Mt)),r!==i){for(n=[],Nt.test(s.charAt(E))?(o=s.charAt(E),E++):(o=i,0===v&&O(Bt));o!==i;)n.push(o),Nt.test(s.charAt(E))?(o=s.charAt(E),E++):(o=i,0===v&&O(Bt));e=n!==i?r=[r,n]:(E=e,i)}else E=e,e=i;return e!==i&&(_=t,e=I(e)),e}if((e=r())!==i&&E===s.length)return e;throw e!==i&&E<s.length&&O({type:"end"}),Gt(S,j<s.length?s.charAt(j):null,j<s.length?L(j,j+1):L(j,j))}const parse=peg$parse;exports.default=parse;