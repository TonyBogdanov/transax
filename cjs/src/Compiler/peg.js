"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const TextCompilerToken_1=require("./TextCompilerToken"),LiteralCompilerToken_1=require("./LiteralCompilerToken"),ExpressionCompilerToken_1=require("./ExpressionCompilerToken"),IdentifierCompilerToken_1=require("./IdentifierCompilerToken"),ObjectAccessCompilerToken_1=require("./ObjectAccessCompilerToken"),ArrayAccessCompilerToken_1=require("./ArrayAccessCompilerToken");function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}class PeggySyntaxError extends Error{static buildMessage(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function c(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var e=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+e+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var e=t.map(c);let r,n;if(e.sort(),0<e.length){for(r=1,n=1;r<e.length;r++)e[r-1]!==e[r]&&(e[n]=e[r],n++);e.length=n}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+((t=e)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,e,r,n){super(),this.message=t,this.expected=e,this.found=r,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(r){let n="Error: "+this.message;if(this.location){let t=null,e;for(e=0;e<r.length;e++)if(r[e].grammarSource===this.location.source){t=r[e].text.split(/\r\n|\n|\r/g);break}var o,c,a,u=this.location.start,i=this.location.source+":"+u.line+":"+u.column;t?(a=this.location.end,o=peg$padEnd("",u.line.toString().length," "),c=t[u.line-1],a=u.line===a.line?a.column:c.length+1,n+="\n --\x3e "+i+"\n"+o+" |\n"+u.line+" | "+c+"\n"+o+" | "+peg$padEnd("",u.column-1," ")+peg$padEnd("",a-u.column,"^")):n+="\n at "+i}return n}}function peg$parse(i,t){const s={},z=(t=void 0!==t?t:{}).grammarSource;var e={Start:zt};let r=zt;function I(t){return new LiteralCompilerToken_1.default(t,w(),$().start.line,$().start.column)}function R(t,e){return new ExpressionCompilerToken_1.default(t,e,w(),$().start.line,$().start.column)}function Z(t){return[t[0],...t[1]].join("")}const o=function(t){return t},l="",M=function(){return[]},U=function(t){return new TextCompilerToken_1.default(w(),$().start.line,$().start.column)},c="{{",N=F("{{",!1),a="}}",B=F("}}",!1),D="@",G=F("@",!1),H=function(t,e){return new IdentifierCompilerToken_1.default(e,"@"===t,w(),$().start.line,$().start.column)},f=".",h=F(".",!1),J=function(t){return new ObjectAccessCompilerToken_1.default(t,w(),$().start.line,$().start.column)},K="[",Q=F("[",!1),V="]",W=F("]",!1),X=function(t){return new ArrayAccessCompilerToken_1.default(t,w(),$().start.line,$().start.column)},n=/^[ \t\r\n]/,u=P([" ","\t","\r","\n"],!1,!1),Y={type:"any"},p="null",tt=F("null",!1),A=function(){return null},et="NULL",rt=F("NULL",!1),nt="0",ot=F("0",!1),ct=function(){return 0},g="-",d=F("-",!1),at=/^[1-9]/,ut=P([["1","9"]],!1,!1),m=/^[0-9]/,C=P([["0","9"]],!1,!1),it=function(t){return parseInt([t[0],t[1],...t[2]].join(""),10)},st=function(t){return parseFloat([t[0],t[1],t[2].join(""),".",t[4].join("")].join(""))},lt=function(t){return parseFloat([...t.slice(0,3),...t[3]].join(""))},ft="'",ht=F("'",!1),x="\\'",pt=F("\\'",!1),At=/^[^']/,gt=P(["'"],!0,!1),dt=function(t){return t.map(t=>"\\'"===t?t[1]:t).join("")},mt='"',Ct=F('"',!1),y='\\"',xt=F('\\"',!1),yt=/^[^"]/,bt=P(['"'],!0,!1),Tt=function(t){return t.map(t=>'\\"'===t?t[1]:t).join("")},_t="`",kt=F("`",!1),b="${",Et=F("${",!1),T="\\`",jt=F("\\`",!1),St=/^[^`]/,vt=P(["`"],!0,!1),wt=function(t){return t.map(([,t])=>"\\`"===t?t[1]:t).join("")},$t=/^[a-zA-Z_$]/,Ft=P([["a","z"],["A","Z"],"_","$"],!1,!1),Pt=/^[a-zA-Z0-9_$]/,Ot=P([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1);let _=0,k=0;const E=[{line:1,column:1}];let j=0,S=[],v=0;if(void 0!==t.startRule){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=e[t.startRule]}function w(){return i.substring(k,_)}function $(){return O(k,_)}function F(t,e){return{type:"literal",text:t,ignoreCase:e}}function P(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Lt(t){var e=E[t];let r;if(e)return e;for(r=t-1;!E[r];)r--;for(e={line:(e=E[r]).line,column:e.column};r<t;)10===i.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return E[t]=e}function O(t,e){var r=Lt(t),n=Lt(e);return{source:z,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function L(t){_<j||(_>j&&(j=_,S=[]),S.push(t))}function qt(t,e,r){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,e),t,e,r)}function zt(){let t,e,r;if(t=_,e=[],(r=(r=Rt())===s?It():r)!==s)for(;r!==s;)e.push(r),(r=Rt())===s&&(r=It());else e=s;return e!==s&&(k=t,e=o(e)),(t=e)===s&&(t=_,(e=l)!==s&&(k=t,e=M()),t=e),t}function It(){let t,e;return t=_,(e=function(){let t,e;t=_,i.length>_?(e=i.charAt(_),_++):(e=s,0===v&&L(Y));e!==s&&(k=t,e=o(e));return t=e}())!==s&&(k=t,e=U(e)),e}function Rt(){let t,e,r,n;return t=_,i.substr(_,2)===c?(e=c,_+=2):(e=s,0===v&&L(N)),t=e!==s&&q()!==s&&(r=(r=Zt())===s?Mt():r)!==s&&q()!==s&&(i.substr(_,2)===a?(n=a,_+=2):(n=s,0===v&&L(B)),n!==s)?(k=t,e=o(r)):(_=t,s)}function Zt(){let t,e;return t=_,(e=(e=function(){let t,e;t=_,i.substr(_,4)===p?(e=p,_+=4):(e=s,0===v&&L(tt));e!==s&&(k=t,e=A());(t=e)===s&&(t=_,i.substr(_,4)===et?(e=et,_+=4):(e=s,0===v&&L(rt)),e!==s&&(k=t,e=A()),t=e);return t}())===s&&(e=function(){let t,e,r,n,o,c;t=_,39===i.charCodeAt(_)?(e=ft,_++):(e=s,0===v&&L(ht));if(e!==s){for(r=[],i.substr(_,2)===x?(n=x,_+=2):(n=s,0===v&&L(pt)),n===s&&(At.test(i.charAt(_))?(n=i.charAt(_),_++):(n=s,0===v&&L(gt)));n!==s;)r.push(n),i.substr(_,2)===x?(n=x,_+=2):(n=s,0===v&&L(pt)),n===s&&(At.test(i.charAt(_))?(n=i.charAt(_),_++):(n=s,0===v&&L(gt)));t=r!==s&&(39===i.charCodeAt(_)?(n=ft,_++):(n=s,0===v&&L(ht)),n!==s)?(k=t,e=dt(r)):(_=t,s)}else _=t,t=s;if(t===s){if(t=_,34===i.charCodeAt(_)?(e=mt,_++):(e=s,0===v&&L(Ct)),e!==s){for(r=[],i.substr(_,2)===y?(n=y,_+=2):(n=s,0===v&&L(xt)),n===s&&(yt.test(i.charAt(_))?(n=i.charAt(_),_++):(n=s,0===v&&L(bt)));n!==s;)r.push(n),i.substr(_,2)===y?(n=y,_+=2):(n=s,0===v&&L(xt)),n===s&&(yt.test(i.charAt(_))?(n=i.charAt(_),_++):(n=s,0===v&&L(bt)));t=r!==s&&(34===i.charCodeAt(_)?(n=mt,_++):(n=s,0===v&&L(Ct)),n!==s)?(k=t,e=Tt(r)):(_=t,s)}else _=t,t=s;if(t===s)if(t=_,96===i.charCodeAt(_)?(e=_t,_++):(e=s,0===v&&L(kt)),e!==s){for(r=[],n=_,o=_,v++,i.substr(_,2)===b?(c=b,_+=2):(c=s,0===v&&L(Et)),v--,o=c===s?void 0:(_=o,s),n=o!==s&&(i.substr(_,2)===T?(c=T,_+=2):(c=s,0===v&&L(jt)),c===s&&(St.test(i.charAt(_))?(c=i.charAt(_),_++):(c=s,0===v&&L(vt))),c!==s)?o=[o,c]:(_=n,s);n!==s;)r.push(n),n=_,o=_,v++,i.substr(_,2)===b?(c=b,_+=2):(c=s,0===v&&L(Et)),v--,o=c===s?void 0:(_=o,s),n=o!==s&&(i.substr(_,2)===T?(c=T,_+=2):(c=s,0===v&&L(jt)),c===s&&(St.test(i.charAt(_))?(c=i.charAt(_),_++):(c=s,0===v&&L(vt))),c!==s)?o=[o,c]:(_=n,s);t=r!==s&&(96===i.charCodeAt(_)?(n=_t,_++):(n=s,0===v&&L(kt)),n!==s)?(k=t,e=wt(r)):(_=t,s)}else _=t,t=s}return t}())===s&&(e=function(){let t,e,r,n,o,c,a,u;t=_,e=_,45===i.charCodeAt(_)?(r=g,_++):(r=s,0===v&&L(d));r===s&&(r=null);if(r!==s)if(at.test(i.charAt(_))?(n=i.charAt(_),_++):(n=s,0===v&&L(ut)),n!==s){for(o=[],m.test(i.charAt(_))?(c=i.charAt(_),_++):(c=s,0===v&&L(C));c!==s;)o.push(c),m.test(i.charAt(_))?(c=i.charAt(_),_++):(c=s,0===v&&L(C));if(o!==s)if(46===i.charCodeAt(_)?(c=f,_++):(c=s,0===v&&L(h)),c!==s){if(a=[],m.test(i.charAt(_))?(u=i.charAt(_),_++):(u=s,0===v&&L(C)),u!==s)for(;u!==s;)a.push(u),m.test(i.charAt(_))?(u=i.charAt(_),_++):(u=s,0===v&&L(C));else a=s;e=a!==s?r=[r,n,o,c,a]:(_=e,s)}else _=e,e=s;else _=e,e=s}else _=e,e=s;else _=e,e=s;e!==s&&(k=t,e=st(e));if((t=e)===s){if(t=_,e=_,45===i.charCodeAt(_)?(r=g,_++):(r=s,0===v&&L(d)),(r=r===s?null:r)!==s)if(48===i.charCodeAt(_)?(n=nt,_++):(n=s,0===v&&L(ot)),(n=n===s?l:n)!==s)if(46===i.charCodeAt(_)?(o=f,_++):(o=s,0===v&&L(h)),o!==s){if(c=[],m.test(i.charAt(_))?(a=i.charAt(_),_++):(a=s,0===v&&L(C)),a!==s)for(;a!==s;)c.push(a),m.test(i.charAt(_))?(a=i.charAt(_),_++):(a=s,0===v&&L(C));else c=s;e=c!==s?r=[r,n,o,c]:(_=e,s)}else _=e,e=s;else _=e,e=s;else _=e,e=s;e!==s&&(k=t,e=lt(e)),t=e}return t}())===s?function(){let t,e,r,n,o,c;t=_,48===i.charCodeAt(_)?(e=nt,_++):(e=s,0===v&&L(ot));e!==s&&(k=t,e=ct());if((t=e)===s){if(t=_,e=_,45===i.charCodeAt(_)?(r=g,_++):(r=s,0===v&&L(d)),(r=r===s?null:r)!==s)if(at.test(i.charAt(_))?(n=i.charAt(_),_++):(n=s,0===v&&L(ut)),n!==s){for(o=[],m.test(i.charAt(_))?(c=i.charAt(_),_++):(c=s,0===v&&L(C));c!==s;)o.push(c),m.test(i.charAt(_))?(c=i.charAt(_),_++):(c=s,0===v&&L(C));e=o!==s?r=[r,n,o]:(_=e,s)}else _=e,e=s;else _=e,e=s;e!==s&&(k=t,e=it(e)),t=e}return t}():e)!==s&&(k=t,e=I(e)),e}function Mt(){let t,e,r,n;if(t=_,(e=function(){let t,e,r;t=_,64===i.charCodeAt(_)?(e=D,_++):(e=s,0===v&&L(G));e===s&&(e=null);t=e!==s&&(r=Bt(),r!==s)?(k=t,e=H(e,r)):(_=t,s);return t}())!==s){for(r=[],(n=Ut())===s&&(n=Nt());n!==s;)r.push(n),(n=Ut())===s&&(n=Nt());t=r!==s?(k=t,R(e,r)):(_=t,s)}else _=t,t=s;return t}function Ut(){let t,e,r,n;return t=_,e=q(),t=e!==s&&(46===i.charCodeAt(_)?(r=f,_++):(r=s,0===v&&L(h)),r!==s)&&q()!==s&&(n=Bt())!==s?(k=t,J(n)):(_=t,s)}function Nt(){let t,e,r,n,o;return t=_,e=q(),t=e!==s&&(91===i.charCodeAt(_)?(r=K,_++):(r=s,0===v&&L(Q)),r!==s)&&q()!==s&&(n=(n=Zt())===s?Mt():n)!==s&&q()!==s&&(93===i.charCodeAt(_)?(o=V,_++):(o=s,0===v&&L(W)),o!==s)?(k=t,X(n)):(_=t,s)}function q(){let t,e;for(t=[],n.test(i.charAt(_))?(e=i.charAt(_),_++):(e=s,0===v&&L(u));e!==s;)t.push(e),n.test(i.charAt(_))?(e=i.charAt(_),_++):(e=s,0===v&&L(u));return t}function Bt(){let t,e,r,n,o;if(t=_,e=_,$t.test(i.charAt(_))?(r=i.charAt(_),_++):(r=s,0===v&&L(Ft)),r!==s){for(n=[],Pt.test(i.charAt(_))?(o=i.charAt(_),_++):(o=s,0===v&&L(Ot));o!==s;)n.push(o),Pt.test(i.charAt(_))?(o=i.charAt(_),_++):(o=s,0===v&&L(Ot));e=n!==s?r=[r,n]:(_=e,s)}else _=e,e=s;return e!==s&&(k=t,e=Z(e)),e}if((e=r())!==s&&_===i.length)return e;throw e!==s&&_<i.length&&L({type:"end"}),qt(S,j<i.length?i.charAt(j):null,j<i.length?O(j,j+1):O(j,j))}const parse=peg$parse;exports.default=parse;