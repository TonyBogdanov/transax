"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const TextCompilerToken_1=require("./TextCompilerToken"),LiteralCompilerToken_1=require("./LiteralCompilerToken"),ExpressionCompilerToken_1=require("./ExpressionCompilerToken"),IdentifierCompilerToken_1=require("./IdentifierCompilerToken"),ObjectAccessCompilerToken_1=require("./ObjectAccessCompilerToken"),ArrayAccessCompilerToken_1=require("./ArrayAccessCompilerToken"),InvocationCompilerToken_1=require("./InvocationCompilerToken");function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}class PeggySyntaxError extends Error{static buildMessage(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function c(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var e=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+e+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var e=t.map(c);let r,n;if(e.sort(),0<e.length){for(r=1,n=1;r<e.length;r++)e[r-1]!==e[r]&&(e[n]=e[r],n++);e.length=n}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+((t=e)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,e,r,n){super(),this.message=t,this.expected=e,this.found=r,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(r){let n="Error: "+this.message;if(this.location){let t=null,e;for(e=0;e<r.length;e++)if(r[e].grammarSource===this.location.source){t=r[e].text.split(/\r\n|\n|\r/g);break}var o,c,u,s=this.location.start,a=this.location.source+":"+s.line+":"+s.column;t?(u=this.location.end,o=peg$padEnd("",s.line.toString().length," "),c=t[s.line-1],u=s.line===u.line?u.column:c.length+1,n+="\n --\x3e "+a+"\n"+o+" |\n"+s.line+" | "+c+"\n"+o+" | "+peg$padEnd("",s.column-1," ")+peg$padEnd("",u-s.column,"^")):n+="\n at "+a}return n}}function peg$parse(a,t){const i={},I=(t=void 0!==t?t:{}).grammarSource;var e={Start:ce};let r=ce;function R(t){return new LiteralCompilerToken_1.default(t,j(),v().start.line,v().start.column)}function U(t,e){return new ExpressionCompilerToken_1.default(t,e,j(),v().start.line,v().start.column)}function z(t){return[t[0],...t[1]].join("")}function Z(t,e){return[t,...e.map(([,,,t])=>t)]}const o=function(t){return t},l="",M=function(){return[]},N=function(t){return new TextCompilerToken_1.default(j(),v().start.line,v().start.column)},c="{{",B=S("{{",!1),D="}}",G=S("}}",!1),H="@",J=S("@",!1),K=function(t,e){return new IdentifierCompilerToken_1.default(e,"@"===t,j(),v().start.line,v().start.column)},f=".",h=S(".",!1),Q=function(t){return new ObjectAccessCompilerToken_1.default(t,j(),v().start.line,v().start.column)},V="[",W=S("[",!1),X="]",Y=S("]",!1),tt=function(t){return new ArrayAccessCompilerToken_1.default(t,j(),v().start.line,v().start.column)},et="(",rt=S("(",!1),nt=")",ot=S(")",!1),ct=function(t){return new InvocationCompilerToken_1.default(null!=t?t:[],j(),v().start.line,v().start.column)},ut=/^[ \t\r\n]/,st=w([" ","\t","\r","\n"],!1,!1),at={type:"any"},it="null",lt=S("null",!1),ft=function(){return null},ht="NULL",pt=S("NULL",!1),At="true",dt=S("true",!1),gt=function(){return!0},mt="TRUE",Ct=S("TRUE",!1),xt="false",yt=S("false",!1),bt=function(){return!1},Tt="FALSE",kt=S("FALSE",!1),Et="0",_t=S("0",!1),jt=function(){return 0},p="-",A=S("-",!1),vt=/^[1-9]/,St=w([["1","9"]],!1,!1),d=/^[0-9]/,g=w([["0","9"]],!1,!1),wt=function(t){return parseInt([t[0],t[1],...t[2]].join(""),10)},Ft=function(t){return parseFloat([t[0],t[1],t[2].join(""),".",t[4].join("")].join(""))},$t=function(t){return parseFloat([...t.slice(0,3),...t[3]].join(""))},Ot="'",Pt=S("'",!1),u="\\'",Lt=S("\\'",!1),s="\\\\",m=S("\\\\",!1),qt=/^[^']/,It=w(["'"],!0,!1),Rt=function(t){return t.map(t=>-1<["\\'","\\\\"].indexOf(t)?t[1]:t).join("")},Ut='"',zt=S('"',!1),C='\\"',Zt=S('\\"',!1),Mt=/^[^"]/,Nt=w(['"'],!0,!1),Bt=function(t){return t.map(t=>-1<['\\"',"\\\\"].indexOf(t)?t[1]:t).join("")},Dt="`",Gt=S("`",!1),x="${",Ht=S("${",!1),y="\\`",Jt=S("\\`",!1),Kt=/^[^`]/,Qt=w(["`"],!0,!1),Vt=function(t){return t.map(([,t])=>-1<["\\`","\\\\"].indexOf(t)?t[1]:t).join("")},Wt=/^[a-zA-Z_$]/,Xt=w([["a","z"],["A","Z"],"_","$"],!1,!1),Yt=/^[a-zA-Z0-9_$]/,te=w([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1),ee=",",re=S(",",!1);let b=0,T=0;const n=[{line:1,column:1}];let k=0,E=[],_=0;if(void 0!==t.startRule){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=e[t.startRule]}function j(){return a.substring(T,b)}function v(){return F(T,b)}function S(t,e){return{type:"literal",text:t,ignoreCase:e}}function w(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function ne(t){var e=n[t];let r;if(e)return e;for(r=t-1;!n[r];)r--;for(e={line:(e=n[r]).line,column:e.column};r<t;)10===a.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return n[t]=e}function F(t,e){var r=ne(t),n=ne(e);return{source:I,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function $(t){b<k||(b>k&&(k=b,E=[]),E.push(t))}function oe(t,e,r){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,e),t,e,r)}function ce(){let t,e,r;if(t=b,e=[],(r=(r=se())===i?ue():r)!==i)for(;r!==i;)e.push(r),(r=se())===i&&(r=ue());else e=i;return e!==i&&(T=t,e=o(e)),(t=e)===i&&(t=b,(e=l)!==i&&(T=t,e=M()),t=e),t}function ue(){let t,e;return t=b,(e=function(){let t,e;t=b,a.length>b?(e=a.charAt(b),b++):(e=i,0===_&&$(at));e!==i&&(T=t,e=o(e));return t=e}())!==i&&(T=t,e=N(e)),e}function se(){let t,e,r,n;return t=b,a.substr(b,2)===c?(e=c,b+=2):(e=i,0===_&&$(B)),t=e!==i&&L()!==i&&(r=(r=O())===i?P():r)!==i&&L()!==i&&(a.substr(b,2)===D?(n=D,b+=2):(n=i,0===_&&$(G)),n!==i)?(T=t,e=o(r)):(b=t,i)}function O(){let t,e;return t=b,(e=(e=function(){let t,e;t=b,a.substr(b,4)===it?(e=it,b+=4):(e=i,0===_&&$(lt));e!==i&&(T=t,e=ft());(t=e)===i&&(t=b,a.substr(b,4)===ht?(e=ht,b+=4):(e=i,0===_&&$(pt)),e!==i&&(T=t,e=ft()),t=e);return t}())===i&&(e=function(){let t,e;t=b,a.substr(b,4)===At?(e=At,b+=4):(e=i,0===_&&$(dt));e!==i&&(T=t,e=gt());(t=e)===i&&(t=b,a.substr(b,4)===mt?(e=mt,b+=4):(e=i,0===_&&$(Ct)),e!==i&&(T=t,e=gt()),(t=e)===i)&&(t=b,a.substr(b,5)===xt?(e=xt,b+=5):(e=i,0===_&&$(yt)),e!==i&&(T=t,e=bt()),(t=e)===i)&&(t=b,a.substr(b,5)===Tt?(e=Tt,b+=5):(e=i,0===_&&$(kt)),e!==i&&(T=t,e=bt()),t=e);return t}())===i&&(e=function(){let t,e,r,n,o,c;t=b,39===a.charCodeAt(b)?(e=Ot,b++):(e=i,0===_&&$(Pt));if(e!==i){for(r=[],a.substr(b,2)===u?(n=u,b+=2):(n=i,0===_&&$(Lt)),n===i&&(a.substr(b,2)===s?(n=s,b+=2):(n=i,0===_&&$(m)),n===i)&&(qt.test(a.charAt(b))?(n=a.charAt(b),b++):(n=i,0===_&&$(It)));n!==i;)r.push(n),a.substr(b,2)===u?(n=u,b+=2):(n=i,0===_&&$(Lt)),n===i&&(a.substr(b,2)===s?(n=s,b+=2):(n=i,0===_&&$(m)),n===i)&&(qt.test(a.charAt(b))?(n=a.charAt(b),b++):(n=i,0===_&&$(It)));t=r!==i&&(39===a.charCodeAt(b)?(n=Ot,b++):(n=i,0===_&&$(Pt)),n!==i)?(T=t,e=Rt(r)):(b=t,i)}else b=t,t=i;if(t===i){if(t=b,34===a.charCodeAt(b)?(e=Ut,b++):(e=i,0===_&&$(zt)),e!==i){for(r=[],a.substr(b,2)===C?(n=C,b+=2):(n=i,0===_&&$(Zt)),n===i&&(a.substr(b,2)===s?(n=s,b+=2):(n=i,0===_&&$(m)),n===i)&&(Mt.test(a.charAt(b))?(n=a.charAt(b),b++):(n=i,0===_&&$(Nt)));n!==i;)r.push(n),a.substr(b,2)===C?(n=C,b+=2):(n=i,0===_&&$(Zt)),n===i&&(a.substr(b,2)===s?(n=s,b+=2):(n=i,0===_&&$(m)),n===i)&&(Mt.test(a.charAt(b))?(n=a.charAt(b),b++):(n=i,0===_&&$(Nt)));t=r!==i&&(34===a.charCodeAt(b)?(n=Ut,b++):(n=i,0===_&&$(zt)),n!==i)?(T=t,e=Bt(r)):(b=t,i)}else b=t,t=i;if(t===i)if(t=b,96===a.charCodeAt(b)?(e=Dt,b++):(e=i,0===_&&$(Gt)),e!==i){for(r=[],n=b,o=b,_++,a.substr(b,2)===x?(c=x,b+=2):(c=i,0===_&&$(Ht)),_--,o=c===i?void 0:(b=o,i),n=o!==i&&(a.substr(b,2)===y?(c=y,b+=2):(c=i,0===_&&$(Jt)),c===i&&(a.substr(b,2)===s?(c=s,b+=2):(c=i,0===_&&$(m)),c===i)&&(Kt.test(a.charAt(b))?(c=a.charAt(b),b++):(c=i,0===_&&$(Qt))),c!==i)?o=[o,c]:(b=n,i);n!==i;)r.push(n),n=b,o=b,_++,a.substr(b,2)===x?(c=x,b+=2):(c=i,0===_&&$(Ht)),_--,o=c===i?void 0:(b=o,i),n=o!==i&&(a.substr(b,2)===y?(c=y,b+=2):(c=i,0===_&&$(Jt)),c===i&&(a.substr(b,2)===s?(c=s,b+=2):(c=i,0===_&&$(m)),c===i)&&(Kt.test(a.charAt(b))?(c=a.charAt(b),b++):(c=i,0===_&&$(Qt))),c!==i)?o=[o,c]:(b=n,i);t=r!==i&&(96===a.charCodeAt(b)?(n=Dt,b++):(n=i,0===_&&$(Gt)),n!==i)?(T=t,e=Vt(r)):(b=t,i)}else b=t,t=i}return t}())===i&&(e=function(){let t,e,r,n,o,c,u,s;t=b,e=b,45===a.charCodeAt(b)?(r=p,b++):(r=i,0===_&&$(A));r===i&&(r=null);if(r!==i)if(vt.test(a.charAt(b))?(n=a.charAt(b),b++):(n=i,0===_&&$(St)),n!==i){for(o=[],d.test(a.charAt(b))?(c=a.charAt(b),b++):(c=i,0===_&&$(g));c!==i;)o.push(c),d.test(a.charAt(b))?(c=a.charAt(b),b++):(c=i,0===_&&$(g));if(o!==i)if(46===a.charCodeAt(b)?(c=f,b++):(c=i,0===_&&$(h)),c!==i){if(u=[],d.test(a.charAt(b))?(s=a.charAt(b),b++):(s=i,0===_&&$(g)),s!==i)for(;s!==i;)u.push(s),d.test(a.charAt(b))?(s=a.charAt(b),b++):(s=i,0===_&&$(g));else u=i;e=u!==i?r=[r,n,o,c,u]:(b=e,i)}else b=e,e=i;else b=e,e=i}else b=e,e=i;else b=e,e=i;e!==i&&(T=t,e=Ft(e));if((t=e)===i){if(t=b,e=b,45===a.charCodeAt(b)?(r=p,b++):(r=i,0===_&&$(A)),(r=r===i?null:r)!==i)if(48===a.charCodeAt(b)?(n=Et,b++):(n=i,0===_&&$(_t)),(n=n===i?l:n)!==i)if(46===a.charCodeAt(b)?(o=f,b++):(o=i,0===_&&$(h)),o!==i){if(c=[],d.test(a.charAt(b))?(u=a.charAt(b),b++):(u=i,0===_&&$(g)),u!==i)for(;u!==i;)c.push(u),d.test(a.charAt(b))?(u=a.charAt(b),b++):(u=i,0===_&&$(g));else c=i;e=c!==i?r=[r,n,o,c]:(b=e,i)}else b=e,e=i;else b=e,e=i;else b=e,e=i;e!==i&&(T=t,e=$t(e)),t=e}return t}())===i?function(){let t,e,r,n,o,c;t=b,48===a.charCodeAt(b)?(e=Et,b++):(e=i,0===_&&$(_t));e!==i&&(T=t,e=jt());if((t=e)===i){if(t=b,e=b,45===a.charCodeAt(b)?(r=p,b++):(r=i,0===_&&$(A)),(r=r===i?null:r)!==i)if(vt.test(a.charAt(b))?(n=a.charAt(b),b++):(n=i,0===_&&$(St)),n!==i){for(o=[],d.test(a.charAt(b))?(c=a.charAt(b),b++):(c=i,0===_&&$(g));c!==i;)o.push(c),d.test(a.charAt(b))?(c=a.charAt(b),b++):(c=i,0===_&&$(g));e=o!==i?r=[r,n,o]:(b=e,i)}else b=e,e=i;else b=e,e=i;e!==i&&(T=t,e=wt(e)),t=e}return t}():e)!==i&&(T=t,e=R(e)),e}function P(){let t,e,r,n;if(t=b,(e=function(){let t,e,r;t=b,64===a.charCodeAt(b)?(e=H,b++):(e=i,0===_&&$(J));e===i&&(e=null);t=e!==i&&(r=fe(),r!==i)?(T=t,e=K(e,r)):(b=t,i);return t}())!==i){for(r=[],(n=ae())===i&&(n=ie())===i&&(n=le());n!==i;)r.push(n),(n=ae())===i&&(n=ie())===i&&(n=le());t=r!==i?(T=t,U(e,r)):(b=t,i)}else b=t,t=i;return t}function ae(){let t,e,r,n;return t=b,e=L(),t=e!==i&&(46===a.charCodeAt(b)?(r=f,b++):(r=i,0===_&&$(h)),r!==i)&&L()!==i&&(n=fe())!==i?(T=t,Q(n)):(b=t,i)}function ie(){let t,e,r,n,o;return t=b,e=L(),t=e!==i&&(91===a.charCodeAt(b)?(r=V,b++):(r=i,0===_&&$(W)),r!==i)&&L()!==i&&(n=(n=O())===i?P():n)!==i&&L()!==i&&(93===a.charCodeAt(b)?(o=X,b++):(o=i,0===_&&$(Y)),o!==i)?(T=t,tt(n)):(b=t,i)}function le(){let t,e,r,n,o;return t=b,e=L(),t=e!==i&&(40===a.charCodeAt(b)?(r=et,b++):(r=i,0===_&&$(rt)),r!==i)&&L()!==i&&(n=(n=function(){let t,e,r,n,o,c,u,s;if(t=b,(e=q())!==i){for(r=[],n=b,o=L(),n=o!==i&&(44===a.charCodeAt(b)?(c=ee,b++):(c=i,0===_&&$(re)),c!==i)&&(u=L())!==i&&(s=q())!==i?o=[o,c,u,s]:(b=n,i);n!==i;)r.push(n),n=b,o=L(),n=o!==i&&(44===a.charCodeAt(b)?(c=ee,b++):(c=i,0===_&&$(re)),c!==i)&&(u=L())!==i&&(s=q())!==i?o=[o,c,u,s]:(b=n,i);t=r!==i?(T=t,e=Z(e,r)):(b=t,i)}else b=t,t=i;return t}())===i?null:n)!==i&&L()!==i&&(41===a.charCodeAt(b)?(o=nt,b++):(o=i,0===_&&$(ot)),o!==i)?(T=t,ct(n)):(b=t,i)}function L(){let t,e;for(t=[],ut.test(a.charAt(b))?(e=a.charAt(b),b++):(e=i,0===_&&$(st));e!==i;)t.push(e),ut.test(a.charAt(b))?(e=a.charAt(b),b++):(e=i,0===_&&$(st));return t}function fe(){let t,e,r,n,o;if(t=b,e=b,Wt.test(a.charAt(b))?(r=a.charAt(b),b++):(r=i,0===_&&$(Xt)),r!==i){for(n=[],Yt.test(a.charAt(b))?(o=a.charAt(b),b++):(o=i,0===_&&$(te));o!==i;)n.push(o),Yt.test(a.charAt(b))?(o=a.charAt(b),b++):(o=i,0===_&&$(te));e=n!==i?r=[r,n]:(b=e,i)}else b=e,e=i;return e!==i&&(T=t,e=z(e)),e}function q(){let t,e;return t=b,(e=(e=O())===i?P():e)!==i&&(T=t,e=o(e)),e}if((e=r())!==i&&b===a.length)return e;throw e!==i&&b<a.length&&$({type:"end"}),oe(E,k<a.length?a.charAt(k):null,k<a.length?F(k,k+1):F(k,k))}const parse=peg$parse;exports.default=parse;