"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const TextCompilerToken_1=require("./TextCompilerToken"),LiteralCompilerToken_1=require("./LiteralCompilerToken"),ExpressionCompilerToken_1=require("./ExpressionCompilerToken"),IdentifierCompilerToken_1=require("./IdentifierCompilerToken"),ObjectAccessCompilerToken_1=require("./ObjectAccessCompilerToken"),ArrayAccessCompilerToken_1=require("./ArrayAccessCompilerToken"),InvocationCompilerToken_1=require("./InvocationCompilerToken");function peg$padEnd(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}class PeggySyntaxError extends Error{static buildMessage(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+r(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+r(t))}function c(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var e=t.parts.map(t=>Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t));return"["+(t.inverted?"^":"")+e+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var e=t.map(c);let r,n;if(e.sort(),0<e.length){for(r=1,n=1;r<e.length;r++)e[r-1]!==e[r]&&(e[n]=e[r],n++);e.length=n}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+((t=e)?'"'+n(t)+'"':"end of input")+" found."}constructor(t,e,r,n){super(),this.message=t,this.expected=e,this.found=r,this.location=n,this.name="PeggySyntaxError","function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(this,PeggySyntaxError.prototype):this.__proto__=PeggySyntaxError.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,PeggySyntaxError)}format(r){let n="Error: "+this.message;if(this.location){let t=null,e;for(e=0;e<r.length;e++)if(r[e].grammarSource===this.location.source){t=r[e].text.split(/\r\n|\n|\r/g);break}var o,c,u,a=this.location.start,i=this.location.source+":"+a.line+":"+a.column;t?(u=this.location.end,o=peg$padEnd("",a.line.toString().length," "),c=t[a.line-1],u=a.line===u.line?u.column:c.length+1,n+="\n --\x3e "+i+"\n"+o+" |\n"+a.line+" | "+c+"\n"+o+" | "+peg$padEnd("",a.column-1," ")+peg$padEnd("",u-a.column,"^")):n+="\n at "+i}return n}}function peg$parse(i,t){const s={},I=(t=void 0!==t?t:{}).grammarSource;var e={Start:ne};let r=ne;function R(t){return new LiteralCompilerToken_1.default(t,j(),v().start.line,v().start.column)}function U(t,e){return new ExpressionCompilerToken_1.default(t,e,j(),v().start.line,v().start.column)}function z(t){return[t[0],...t[1]].join("")}function Z(t,e){return[t,...e.map(([,,,t])=>t)]}const o=function(t){return t},l="",M=function(){return[]},N=function(t){return new TextCompilerToken_1.default(j(),v().start.line,v().start.column)},c="{{",B=S("{{",!1),u="}}",D=S("}}",!1),G="@",H=S("@",!1),J=function(t,e){return new IdentifierCompilerToken_1.default(e,"@"===t,j(),v().start.line,v().start.column)},f=".",h=S(".",!1),K=function(t){return new ObjectAccessCompilerToken_1.default(t,j(),v().start.line,v().start.column)},Q="[",V=S("[",!1),W="]",X=S("]",!1),Y=function(t){return new ArrayAccessCompilerToken_1.default(t,j(),v().start.line,v().start.column)},tt="(",et=S("(",!1),rt=")",nt=S(")",!1),ot=function(t){return new InvocationCompilerToken_1.default(null!=t?t:[],j(),v().start.line,v().start.column)},n=/^[ \t\r\n]/,ct=w([" ","\t","\r","\n"],!1,!1),ut={type:"any"},at="null",it=S("null",!1),st=function(){return null},lt="NULL",ft=S("NULL",!1),ht="true",pt=S("true",!1),At=function(){return!0},gt="TRUE",dt=S("TRUE",!1),mt="false",Ct=S("false",!1),xt=function(){return!1},yt="FALSE",Tt=S("FALSE",!1),bt="0",kt=S("0",!1),Et=function(){return 0},p="-",A=S("-",!1),_t=/^[1-9]/,jt=w([["1","9"]],!1,!1),g=/^[0-9]/,d=w([["0","9"]],!1,!1),vt=function(t){return parseInt([t[0],t[1],...t[2]].join(""),10)},St=function(t){return parseFloat([t[0],t[1],t[2].join(""),".",t[4].join("")].join(""))},wt=function(t){return parseFloat([...t.slice(0,3),...t[3]].join(""))},Ft="'",$t=S("'",!1),a="\\'",Pt=S("\\'",!1),Lt=/^[^']/,Ot=w(["'"],!0,!1),qt=function(t){return t.map(t=>"\\'"===t?t[1]:t).join("")},It='"',Rt=S('"',!1),m='\\"',Ut=S('\\"',!1),zt=/^[^"]/,Zt=w(['"'],!0,!1),Mt=function(t){return t.map(t=>'\\"'===t?t[1]:t).join("")},Nt="`",Bt=S("`",!1),C="${",Dt=S("${",!1),x="\\`",Gt=S("\\`",!1),Ht=/^[^`]/,Jt=w(["`"],!0,!1),Kt=function(t){return t.map(([,t])=>"\\`"===t?t[1]:t).join("")},Qt=/^[a-zA-Z_$]/,Vt=w([["a","z"],["A","Z"],"_","$"],!1,!1),Wt=/^[a-zA-Z0-9_$]/,Xt=w([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1),Yt=",",te=S(",",!1);let y=0,T=0;const b=[{line:1,column:1}];let k=0,E=[],_=0;if(void 0!==t.startRule){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=e[t.startRule]}function j(){return i.substring(T,y)}function v(){return F(T,y)}function S(t,e){return{type:"literal",text:t,ignoreCase:e}}function w(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function ee(t){var e=b[t];let r;if(e)return e;for(r=t-1;!b[r];)r--;for(e={line:(e=b[r]).line,column:e.column};r<t;)10===i.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return b[t]=e}function F(t,e){var r=ee(t),n=ee(e);return{source:I,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function $(t){y<k||(y>k&&(k=y,E=[]),E.push(t))}function re(t,e,r){return new PeggySyntaxError(PeggySyntaxError.buildMessage(t,e),t,e,r)}function ne(){let t,e,r;if(t=y,e=[],(r=(r=ce())===s?oe():r)!==s)for(;r!==s;)e.push(r),(r=ce())===s&&(r=oe());else e=s;return e!==s&&(T=t,e=o(e)),(t=e)===s&&(t=y,(e=l)!==s&&(T=t,e=M()),t=e),t}function oe(){let t,e;return t=y,(e=function(){let t,e;t=y,i.length>y?(e=i.charAt(y),y++):(e=s,0===_&&$(ut));e!==s&&(T=t,e=o(e));return t=e}())!==s&&(T=t,e=N(e)),e}function ce(){let t,e,r,n;return t=y,i.substr(y,2)===c?(e=c,y+=2):(e=s,0===_&&$(B)),t=e!==s&&O()!==s&&(r=(r=P())===s?L():r)!==s&&O()!==s&&(i.substr(y,2)===u?(n=u,y+=2):(n=s,0===_&&$(D)),n!==s)?(T=t,e=o(r)):(y=t,s)}function P(){let t,e;return t=y,(e=(e=function(){let t,e;t=y,i.substr(y,4)===at?(e=at,y+=4):(e=s,0===_&&$(it));e!==s&&(T=t,e=st());(t=e)===s&&(t=y,i.substr(y,4)===lt?(e=lt,y+=4):(e=s,0===_&&$(ft)),e!==s&&(T=t,e=st()),t=e);return t}())===s&&(e=function(){let t,e;t=y,i.substr(y,4)===ht?(e=ht,y+=4):(e=s,0===_&&$(pt));e!==s&&(T=t,e=At());(t=e)===s&&(t=y,i.substr(y,4)===gt?(e=gt,y+=4):(e=s,0===_&&$(dt)),e!==s&&(T=t,e=At()),(t=e)===s)&&(t=y,i.substr(y,5)===mt?(e=mt,y+=5):(e=s,0===_&&$(Ct)),e!==s&&(T=t,e=xt()),(t=e)===s)&&(t=y,i.substr(y,5)===yt?(e=yt,y+=5):(e=s,0===_&&$(Tt)),e!==s&&(T=t,e=xt()),t=e);return t}())===s&&(e=function(){let t,e,r,n,o,c;t=y,39===i.charCodeAt(y)?(e=Ft,y++):(e=s,0===_&&$($t));if(e!==s){for(r=[],i.substr(y,2)===a?(n=a,y+=2):(n=s,0===_&&$(Pt)),n===s&&(Lt.test(i.charAt(y))?(n=i.charAt(y),y++):(n=s,0===_&&$(Ot)));n!==s;)r.push(n),i.substr(y,2)===a?(n=a,y+=2):(n=s,0===_&&$(Pt)),n===s&&(Lt.test(i.charAt(y))?(n=i.charAt(y),y++):(n=s,0===_&&$(Ot)));t=r!==s&&(39===i.charCodeAt(y)?(n=Ft,y++):(n=s,0===_&&$($t)),n!==s)?(T=t,e=qt(r)):(y=t,s)}else y=t,t=s;if(t===s){if(t=y,34===i.charCodeAt(y)?(e=It,y++):(e=s,0===_&&$(Rt)),e!==s){for(r=[],i.substr(y,2)===m?(n=m,y+=2):(n=s,0===_&&$(Ut)),n===s&&(zt.test(i.charAt(y))?(n=i.charAt(y),y++):(n=s,0===_&&$(Zt)));n!==s;)r.push(n),i.substr(y,2)===m?(n=m,y+=2):(n=s,0===_&&$(Ut)),n===s&&(zt.test(i.charAt(y))?(n=i.charAt(y),y++):(n=s,0===_&&$(Zt)));t=r!==s&&(34===i.charCodeAt(y)?(n=It,y++):(n=s,0===_&&$(Rt)),n!==s)?(T=t,e=Mt(r)):(y=t,s)}else y=t,t=s;if(t===s)if(t=y,96===i.charCodeAt(y)?(e=Nt,y++):(e=s,0===_&&$(Bt)),e!==s){for(r=[],n=y,o=y,_++,i.substr(y,2)===C?(c=C,y+=2):(c=s,0===_&&$(Dt)),_--,o=c===s?void 0:(y=o,s),n=o!==s&&(i.substr(y,2)===x?(c=x,y+=2):(c=s,0===_&&$(Gt)),c===s&&(Ht.test(i.charAt(y))?(c=i.charAt(y),y++):(c=s,0===_&&$(Jt))),c!==s)?o=[o,c]:(y=n,s);n!==s;)r.push(n),n=y,o=y,_++,i.substr(y,2)===C?(c=C,y+=2):(c=s,0===_&&$(Dt)),_--,o=c===s?void 0:(y=o,s),n=o!==s&&(i.substr(y,2)===x?(c=x,y+=2):(c=s,0===_&&$(Gt)),c===s&&(Ht.test(i.charAt(y))?(c=i.charAt(y),y++):(c=s,0===_&&$(Jt))),c!==s)?o=[o,c]:(y=n,s);t=r!==s&&(96===i.charCodeAt(y)?(n=Nt,y++):(n=s,0===_&&$(Bt)),n!==s)?(T=t,e=Kt(r)):(y=t,s)}else y=t,t=s}return t}())===s&&(e=function(){let t,e,r,n,o,c,u,a;t=y,e=y,45===i.charCodeAt(y)?(r=p,y++):(r=s,0===_&&$(A));r===s&&(r=null);if(r!==s)if(_t.test(i.charAt(y))?(n=i.charAt(y),y++):(n=s,0===_&&$(jt)),n!==s){for(o=[],g.test(i.charAt(y))?(c=i.charAt(y),y++):(c=s,0===_&&$(d));c!==s;)o.push(c),g.test(i.charAt(y))?(c=i.charAt(y),y++):(c=s,0===_&&$(d));if(o!==s)if(46===i.charCodeAt(y)?(c=f,y++):(c=s,0===_&&$(h)),c!==s){if(u=[],g.test(i.charAt(y))?(a=i.charAt(y),y++):(a=s,0===_&&$(d)),a!==s)for(;a!==s;)u.push(a),g.test(i.charAt(y))?(a=i.charAt(y),y++):(a=s,0===_&&$(d));else u=s;e=u!==s?r=[r,n,o,c,u]:(y=e,s)}else y=e,e=s;else y=e,e=s}else y=e,e=s;else y=e,e=s;e!==s&&(T=t,e=St(e));if((t=e)===s){if(t=y,e=y,45===i.charCodeAt(y)?(r=p,y++):(r=s,0===_&&$(A)),(r=r===s?null:r)!==s)if(48===i.charCodeAt(y)?(n=bt,y++):(n=s,0===_&&$(kt)),(n=n===s?l:n)!==s)if(46===i.charCodeAt(y)?(o=f,y++):(o=s,0===_&&$(h)),o!==s){if(c=[],g.test(i.charAt(y))?(u=i.charAt(y),y++):(u=s,0===_&&$(d)),u!==s)for(;u!==s;)c.push(u),g.test(i.charAt(y))?(u=i.charAt(y),y++):(u=s,0===_&&$(d));else c=s;e=c!==s?r=[r,n,o,c]:(y=e,s)}else y=e,e=s;else y=e,e=s;else y=e,e=s;e!==s&&(T=t,e=wt(e)),t=e}return t}())===s?function(){let t,e,r,n,o,c;t=y,48===i.charCodeAt(y)?(e=bt,y++):(e=s,0===_&&$(kt));e!==s&&(T=t,e=Et());if((t=e)===s){if(t=y,e=y,45===i.charCodeAt(y)?(r=p,y++):(r=s,0===_&&$(A)),(r=r===s?null:r)!==s)if(_t.test(i.charAt(y))?(n=i.charAt(y),y++):(n=s,0===_&&$(jt)),n!==s){for(o=[],g.test(i.charAt(y))?(c=i.charAt(y),y++):(c=s,0===_&&$(d));c!==s;)o.push(c),g.test(i.charAt(y))?(c=i.charAt(y),y++):(c=s,0===_&&$(d));e=o!==s?r=[r,n,o]:(y=e,s)}else y=e,e=s;else y=e,e=s;e!==s&&(T=t,e=vt(e)),t=e}return t}():e)!==s&&(T=t,e=R(e)),e}function L(){let t,e,r,n;if(t=y,(e=function(){let t,e,r;t=y,64===i.charCodeAt(y)?(e=G,y++):(e=s,0===_&&$(H));e===s&&(e=null);t=e!==s&&(r=se(),r!==s)?(T=t,e=J(e,r)):(y=t,s);return t}())!==s){for(r=[],(n=ue())===s&&(n=ae())===s&&(n=ie());n!==s;)r.push(n),(n=ue())===s&&(n=ae())===s&&(n=ie());t=r!==s?(T=t,U(e,r)):(y=t,s)}else y=t,t=s;return t}function ue(){let t,e,r,n;return t=y,e=O(),t=e!==s&&(46===i.charCodeAt(y)?(r=f,y++):(r=s,0===_&&$(h)),r!==s)&&O()!==s&&(n=se())!==s?(T=t,K(n)):(y=t,s)}function ae(){let t,e,r,n,o;return t=y,e=O(),t=e!==s&&(91===i.charCodeAt(y)?(r=Q,y++):(r=s,0===_&&$(V)),r!==s)&&O()!==s&&(n=(n=P())===s?L():n)!==s&&O()!==s&&(93===i.charCodeAt(y)?(o=W,y++):(o=s,0===_&&$(X)),o!==s)?(T=t,Y(n)):(y=t,s)}function ie(){let t,e,r,n,o;return t=y,e=O(),t=e!==s&&(40===i.charCodeAt(y)?(r=tt,y++):(r=s,0===_&&$(et)),r!==s)&&O()!==s&&(n=(n=function(){let t,e,r,n,o,c,u,a;if(t=y,(e=q())!==s){for(r=[],n=y,o=O(),n=o!==s&&(44===i.charCodeAt(y)?(c=Yt,y++):(c=s,0===_&&$(te)),c!==s)&&(u=O())!==s&&(a=q())!==s?o=[o,c,u,a]:(y=n,s);n!==s;)r.push(n),n=y,o=O(),n=o!==s&&(44===i.charCodeAt(y)?(c=Yt,y++):(c=s,0===_&&$(te)),c!==s)&&(u=O())!==s&&(a=q())!==s?o=[o,c,u,a]:(y=n,s);t=r!==s?(T=t,e=Z(e,r)):(y=t,s)}else y=t,t=s;return t}())===s?null:n)!==s&&O()!==s&&(41===i.charCodeAt(y)?(o=rt,y++):(o=s,0===_&&$(nt)),o!==s)?(T=t,ot(n)):(y=t,s)}function O(){let t,e;for(t=[],n.test(i.charAt(y))?(e=i.charAt(y),y++):(e=s,0===_&&$(ct));e!==s;)t.push(e),n.test(i.charAt(y))?(e=i.charAt(y),y++):(e=s,0===_&&$(ct));return t}function se(){let t,e,r,n,o;if(t=y,e=y,Qt.test(i.charAt(y))?(r=i.charAt(y),y++):(r=s,0===_&&$(Vt)),r!==s){for(n=[],Wt.test(i.charAt(y))?(o=i.charAt(y),y++):(o=s,0===_&&$(Xt));o!==s;)n.push(o),Wt.test(i.charAt(y))?(o=i.charAt(y),y++):(o=s,0===_&&$(Xt));e=n!==s?r=[r,n]:(y=e,s)}else y=e,e=s;return e!==s&&(T=t,e=z(e)),e}function q(){let t,e;return t=y,(e=(e=P())===s?L():e)!==s&&(T=t,e=o(e)),e}if((e=r())!==s&&y===i.length)return e;throw e!==s&&y<i.length&&$({type:"end"}),re(E,k<i.length?i.charAt(k):null,k<i.length?F(k,k+1):F(k,k))}const parse=peg$parse;exports.default=parse;