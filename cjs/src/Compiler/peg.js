"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const TextToken_1=require("./TextToken"),LiteralToken_1=require("./LiteralToken"),CallExpressionToken_1=require("./CallExpressionToken"),peggyParser=function(){function fr(t,r,e,n){t=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(t,fr.prototype),t.expected=r,t.found=e,t.location=n,t.name="SyntaxError",t}function t(){this.constructor=r}var r,e;function l(t,r,e){return e=e||" ",t.length>r?t:(r-=t.length,t+(e+=e.repeat(r)).slice(0,r))}return r=fr,e=Error,t.prototype=e.prototype,r.prototype=new t,fr.prototype.format=function(t){var r="Error: "+this.message;if(this.location){for(var e=null,n=0;n<t.length;n++)if(t[n].source===this.location.source){e=t[n].text.split(/\r\n|\n|\r/g);break}var a,o,c,u=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(u):u,i=this.location.source+":"+s.line+":"+s.column;e?(c=this.location.end,a=l("",s.line.toString().length," "),o=e[u.line-1],c=(u.line===c.line?c.column:o.length+1)-u.column||1,r+="\n --\x3e "+i+"\n"+a+" |\n"+s.line+" | "+o+"\n"+a+" | "+l("",u.column-1," ")+l("",c,"^")):r+="\n at "+i}return r},fr.buildMessage=function(t,r){var e={literal:function(t){return'"'+a(t.text)+'"'},class:function(t){var r=t.parts.map(function(t){return Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t)});return"["+(t.inverted?"^":"")+r.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function a(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function c(t){return e[t.type](t)}return"Expected "+function(t){var r,e,n=t.map(c);if(n.sort(),0<n.length){for(e=r=1;r<n.length;r++)n[r-1]!==n[r]&&(n[e]=n[r],e++);n.length=e}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+((t=r)?'"'+a(t)+'"':"end of input")+" found."},{SyntaxError:fr,parse:function(l,t){function U(t,r){return[t,...r.map(([,,,t])=>t)]}function z(t){return[t[0],...t[1]].join("")}function Z(t){return t.map(t=>-1<["\\'","\\\\"].indexOf(t)?t[1]:t).join("")}function q(t){return t.map(t=>-1<['\\"',"\\\\"].indexOf(t)?t[1]:t).join("")}function M(t){return t.map(([,t])=>-1<["\\`","\\\\"].indexOf(t)?t[1]:t).join("")}var h={},o=(t=void 0!==t?t:{}).grammarSource,r={Start:nr},N=nr,I="{{",B="}}",s="(",i=")",D="@",f=".",G="[",H="]",J=",",K="null",Q="NULL",V="true",W="TRUE",X="false",Y="FALSE",tt="'",c="\\'",u="\\\\",rt='"',A='\\"',et="`",p="${",d="\\`",nt="0",g="e",at=/^[ \t\r\n]/,ot=/^[a-zA-Z_$]/,C=/^[a-zA-Z0-9_$]/,ct=/^[^']/,ut=/^[^"]/,st=/^[^`]/,x=/^[0-9]/,v=/^[+\-]/,it=/^[1-9]/,lt=j("{{",!1),ht=j("}}",!1),ft={type:"any"},b=j("(",!1),y=j(")",!1),At=j("@",!1),m=j(".",!1),pt=j("[",!1),dt=j("]",!1),gt=j(",",!1),Ct=O([" ","\t","\r","\n"],!1,!1),xt=O([["a","z"],["A","Z"],"_","$"],!1,!1),E=O([["a","z"],["A","Z"],["0","9"],"_","$"],!1,!1),vt=j("null",!1),bt=j("NULL",!1),yt=j("true",!1),mt=j("TRUE",!1),Et=j("false",!1),Tt=j("FALSE",!1),wt=j("'",!1),_t=j("\\'",!1),T=j("\\\\",!1),kt=O(["'"],!0,!1),Lt=j('"',!1),Ft=j('\\"',!1),St=O(['"'],!0,!1),jt=j("`",!1),Ot=j("${",!1),Pt=j("\\`",!1),Rt=O(["`"],!0,!1),w=O([["0","9"]],!1,!1),_=O(["+","-"],!1,!1),$t=j("0",!1),Ut=O([["1","9"]],!1,!1),zt=j("e",!0),Zt=function(t){return t},qt=function(){return[]},Mt=function(t){return t},Nt=function(){return new TextToken_1.default(a(),S())},It=function(t,r,e){return new CallExpressionToken_1.CallExpressionObjectAccess(e)},Bt=function(t,r,e){return new CallExpressionToken_1.CallExpressionArrayAccess(e)},Dt=function(t,r,e){return new CallExpressionToken_1.CallExpressionInvocation(null!=e?e:[])},Gt=function(t,r,e){return new CallExpressionToken_1.default("@"===t,r,e,a(),S())},Ht=function(t){return new LiteralToken_1.default(t,a(),S())},Jt=function(t){return new LiteralToken_1.default(t,a(),S())},Kt=function(t){return new LiteralToken_1.default(t,a(),S())},Qt=function(t){return new LiteralToken_1.default(t,a(),S())},Vt=function(){return parseFloat(a())},Wt=function(){return parseFloat(a())},Xt=function(){return parseFloat(a())},k=0,L=0,n=[{line:1,column:1}],e=0,Yt=[],F=0;if("startRule"in t){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');N=r[t.startRule]}function a(){return l.substring(L,k)}function S(){return rr(L,k)}function j(t,r){return{type:"literal",text:t,ignoreCase:r}}function O(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function tr(t){var r,e=n[t];if(e)return e;for(r=t-1;!n[r];)r--;for(e={line:(e=n[r]).line,column:e.column};r<t;)10===l.charCodeAt(r)?(e.line++,e.column=1):e.column++,r++;return n[t]=e}function rr(t,r,e){var n=tr(t),a=tr(r),t={source:o,start:{offset:t,line:n.line,column:n.column},end:{offset:r,line:a.line,column:a.column}};return e&&o&&"function"==typeof o.offset&&(t.start=o.offset(t.start),t.end=o.offset(t.end)),t}function P(t){k<e||(e<k&&(e=k,Yt=[]),Yt.push(t))}function er(t,r,e){return new fr(fr.buildMessage(t,r),t,r,e)}function nr(){var t=k,r=[],e=ar();if((e=e===h?or():e)!==h)for(;e!==h;)r.push(e),(e=ar())===h&&(e=or());else r=h;return r!==h&&(L=t,r=Zt(r)),(t=r)===h&&(r="",L=t=k,t=r=qt()),t}function ar(){var t,r,e=k;return l.substr(k,2)===I?(t=I,k+=2):(t=h,0===F&&P(lt)),e=t!==h&&($(),(t=R())!==h)&&($(),l.substr(k,2)===B?(r=B,k+=2):(r=h,0===F&&P(ht)),r!==h)?(L=e,Mt(t)):(k=e,h)}function or(){var t,r=k;return l.length>k?(t=l.charAt(k),k++):(t=h,0===F&&P(ft)),t!==h&&(L=r,t=Nt()),t}function R(){var t,r,e,n=k;return 40===l.charCodeAt(k)?(t=s,k++):(t=h,0===F&&P(b)),n=(n=t!==h&&($(),(r=cr())!==h)&&($(),41===l.charCodeAt(k)?(e=i,k++):(e=h,0===F&&P(y)),e!==h)?(L=n,r):(k=n,h))===h&&(n=cr())===h&&(n=k,40===l.charCodeAt(k)?(t=s,k++):(t=h,0===F&&P(b)),(n=t!==h&&($(),(r=sr())!==h)&&($(),41===l.charCodeAt(k)?(e=i,k++):(e=h,0===F&&P(y)),e!==h)?(L=n,r):(k=n,h))===h)?sr():n}function cr(){var t,r,e,n,a,o,c,u=k;if(64===l.charCodeAt(k)?(t=D,k++):(t=h,0===F&&P(At)),t===h&&(t=null),(r=ir())!==h){for(e=[],n=k,$(),46===l.charCodeAt(k)?(a=f,k++):(a=h,0===F&&P(m)),(n=a!==h&&($(),(o=ir())!==h)?(L=n,It(t,r,o)):(k=n,h))===h&&(n=k,$(),91===l.charCodeAt(k)?(a=G,k++):(a=h,0===F&&P(pt)),(n=a!==h&&($(),(o=R())!==h)&&($(),93===l.charCodeAt(k)?(c=H,k++):(c=h,0===F&&P(dt)),c!==h)?(L=n,Bt(t,r,o)):(k=n,h))===h)&&(n=k,$(),40===l.charCodeAt(k)?(a=s,k++):(a=h,0===F&&P(b)),n=a!==h&&($(),(o=ur())===h&&(o=null),$(),41===l.charCodeAt(k)?(c=i,k++):(c=h,0===F&&P(y)),c!==h)?(L=n,Dt(t,r,o)):(k=n,h));n!==h;)e.push(n),n=k,$(),46===l.charCodeAt(k)?(a=f,k++):(a=h,0===F&&P(m)),(n=a!==h&&($(),(o=ir())!==h)?(L=n,It(t,r,o)):(k=n,h))===h&&(n=k,$(),91===l.charCodeAt(k)?(a=G,k++):(a=h,0===F&&P(pt)),(n=a!==h&&($(),(o=R())!==h)&&($(),93===l.charCodeAt(k)?(c=H,k++):(c=h,0===F&&P(dt)),c!==h)?(L=n,Bt(t,r,o)):(k=n,h))===h)&&(n=k,$(),40===l.charCodeAt(k)?(a=s,k++):(a=h,0===F&&P(b)),n=a!==h&&($(),(o=ur())===h&&(o=null),$(),41===l.charCodeAt(k)?(c=i,k++):(c=h,0===F&&P(y)),c!==h)?(L=n,Dt(t,r,o)):(k=n,h));L=u,u=Gt(t,r,e)}else k=u,u=h;return u}function ur(){var t,r,e,n,a,o,c=k,u=R();if(u!==h){for(t=[],r=k,e=$(),44===l.charCodeAt(k)?(n=J,k++):(n=h,0===F&&P(gt)),r=n!==h&&(a=$(),(o=R())!==h)?e=[e,n,a,o]:(k=r,h);r!==h;)t.push(r),r=k,e=$(),44===l.charCodeAt(k)?(n=J,k++):(n=h,0===F&&P(gt)),r=n!==h&&(a=$(),(o=R())!==h)?e=[e,n,a,o]:(k=r,h);L=c,c=U(u,t)}else k=c,c=h;return c}function sr(){var t=k,r=lr();return r!==h&&(L=t,r=Ht(r)),(t=r)===h&&(t=k,(r=hr())!==h&&(L=t,r=Jt(r)),(t=r)===h)&&(t=k,(r=function(){var t,r,e,n;t=k,t=(r=function(){var t,r,e,n,a,o,c,u,s,i;t=k,v.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===F&&P(_));r===h&&(r=null);48===l.charCodeAt(k)?(e=nt,k++):(e=h,0===F&&P($t));if(e===h)if(e=k,it.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(Ut)),n!==h){for(a=[],x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(w));o!==h;)a.push(o),x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(w));e=n=[n,a]}else k=e,e=h;if(e!==h)if(46===l.charCodeAt(k)?(n=f,k++):(n=h,0===F&&P(m)),n!==h){for(a=[],x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(w));o!==h;)a.push(o),x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(w));if(o=k,l.substr(k,1).toLowerCase()===g?(c=l.charAt(k),k++):(c=h,0===F&&P(zt)),c!==h){if(v.test(l.charAt(k))?(u=l.charAt(k),k++):(u=h,0===F&&P(_)),u===h&&(u=null),s=[],x.test(l.charAt(k))?(i=l.charAt(k),k++):(i=h,0===F&&P(w)),i!==h)for(;i!==h;)s.push(i),x.test(l.charAt(k))?(i=l.charAt(k),k++):(i=h,0===F&&P(w));else s=h;o=s!==h?c=[c,u,s]:(k=o,h)}else k=o,o=h;o===h&&(o=null),L=t,t=Vt()}else k=t,t=h;else k=t,t=h;if(t===h){if(t=k,v.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===F&&P(_)),r===h&&(r=null),46===l.charCodeAt(k)?(e=f,k++):(e=h,0===F&&P(m)),e!==h){if(n=[],x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===F&&P(w)),a!==h)for(;a!==h;)n.push(a),x.test(l.charAt(k))?(a=l.charAt(k),k++):(a=h,0===F&&P(w));else n=h;if(n!==h){if(a=k,l.substr(k,1).toLowerCase()===g?(o=l.charAt(k),k++):(o=h,0===F&&P(zt)),o!==h){if(v.test(l.charAt(k))?(c=l.charAt(k),k++):(c=h,0===F&&P(_)),c===h&&(c=null),u=[],x.test(l.charAt(k))?(s=l.charAt(k),k++):(s=h,0===F&&P(w)),s!==h)for(;s!==h;)u.push(s),x.test(l.charAt(k))?(s=l.charAt(k),k++):(s=h,0===F&&P(w));else u=h;a=u!==h?o=[o,c,u]:(k=a,h)}else k=a,a=h;a===h&&(a=null),L=t,t=Wt()}else k=t,t=h}else k=t,t=h;if(t===h){if(t=k,v.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===F&&P(_)),r===h&&(r=null),48===l.charCodeAt(k)?(e=nt,k++):(e=h,0===F&&P($t)),e===h)if(e=k,it.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(Ut)),n!==h){for(a=[],x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(w));o!==h;)a.push(o),x.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(w));e=n=[n,a]}else k=e,e=h;if(e!==h){if(n=k,l.substr(k,1).toLowerCase()===g?(a=l.charAt(k),k++):(a=h,0===F&&P(zt)),a!==h){if(v.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(_)),o===h&&(o=null),c=[],x.test(l.charAt(k))?(u=l.charAt(k),k++):(u=h,0===F&&P(w)),u!==h)for(;u!==h;)c.push(u),x.test(l.charAt(k))?(u=l.charAt(k),k++):(u=h,0===F&&P(w));else c=h;n=c!==h?a=[a,o,c]:(k=n,h)}else k=n,n=h;n===h&&(n=null),L=t,t=Xt()}else k=t,t=h}}return t}())!==h&&(e=k,F++,ot.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(xt)),n===h&&(x.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(w))),F--,e=n===h?void 0:(k=e,h),e!==h)?(L=t,r):(k=t,h);return t}())!==h&&(L=t,r=Kt(r)),(t=r)===h)&&(t=k,(r=function(){var t,r,e,n,a,o;t=k,39===l.charCodeAt(k)?(r=tt,k++):(r=h,0===F&&P(wt));if(r!==h){for(e=[],l.substr(k,2)===c?(n=c,k+=2):(n=h,0===F&&P(_t)),n===h&&(l.substr(k,2)===u?(n=u,k+=2):(n=h,0===F&&P(T)),n===h)&&(ct.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(kt)));n!==h;)e.push(n),l.substr(k,2)===c?(n=c,k+=2):(n=h,0===F&&P(_t)),n===h&&(l.substr(k,2)===u?(n=u,k+=2):(n=h,0===F&&P(T)),n===h)&&(ct.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(kt)));39===l.charCodeAt(k)?(n=tt,k++):(n=h,0===F&&P(wt)),t=n!==h?(L=t,Z(e)):(k=t,h)}else k=t,t=h;if(t===h){if(t=k,34===l.charCodeAt(k)?(r=rt,k++):(r=h,0===F&&P(Lt)),r!==h){for(e=[],l.substr(k,2)===A?(n=A,k+=2):(n=h,0===F&&P(Ft)),n===h&&(l.substr(k,2)===u?(n=u,k+=2):(n=h,0===F&&P(T)),n===h)&&(ut.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(St)));n!==h;)e.push(n),l.substr(k,2)===A?(n=A,k+=2):(n=h,0===F&&P(Ft)),n===h&&(l.substr(k,2)===u?(n=u,k+=2):(n=h,0===F&&P(T)),n===h)&&(ut.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(St)));34===l.charCodeAt(k)?(n=rt,k++):(n=h,0===F&&P(Lt)),t=n!==h?(L=t,q(e)):(k=t,h)}else k=t,t=h;if(t===h)if(t=k,96===l.charCodeAt(k)?(r=et,k++):(r=h,0===F&&P(jt)),r!==h){for(e=[],a=n=k,F++,l.substr(k,2)===p?(o=p,k+=2):(o=h,0===F&&P(Ot)),F--,a=o===h?void 0:(k=a,h),n=a!==h&&(l.substr(k,2)===d?(o=d,k+=2):(o=h,0===F&&P(Pt)),o===h&&(l.substr(k,2)===u?(o=u,k+=2):(o=h,0===F&&P(T)),o===h)&&(st.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(Rt))),o!==h)?a=[a,o]:(k=n,h);n!==h;)e.push(n),a=n=k,F++,l.substr(k,2)===p?(o=p,k+=2):(o=h,0===F&&P(Ot)),F--,a=o===h?void 0:(k=a,h),n=a!==h&&(l.substr(k,2)===d?(o=d,k+=2):(o=h,0===F&&P(Pt)),o===h&&(l.substr(k,2)===u?(o=u,k+=2):(o=h,0===F&&P(T)),o===h)&&(st.test(l.charAt(k))?(o=l.charAt(k),k++):(o=h,0===F&&P(Rt))),o!==h)?a=[a,o]:(k=n,h);96===l.charCodeAt(k)?(n=et,k++):(n=h,0===F&&P(jt)),t=n!==h?(L=t,M(e)):(k=t,h)}else k=t,t=h}return t}())!==h&&(L=t,r=Qt(r)),t=r),t}function $(){var t,r=[];for(at.test(l.charAt(k))?(t=l.charAt(k),k++):(t=h,0===F&&P(Ct));t!==h;)r.push(t),at.test(l.charAt(k))?(t=l.charAt(k),k++):(t=h,0===F&&P(Ct));return r}function ir(){var t,r,e,n,a=k,o=k;if(F++,t=function(){var t;(t=lr())===h&&(t=hr());return t}(),F--,(o=t===h?void 0:(k=o,h))!==h){if(t=k,ot.test(l.charAt(k))?(r=l.charAt(k),k++):(r=h,0===F&&P(xt)),r!==h){for(e=[],C.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(E));n!==h;)e.push(n),C.test(l.charAt(k))?(n=l.charAt(k),k++):(n=h,0===F&&P(E));t=r=[r,e]}else k=t,t=h;a=t!==h?(L=a,z(t)):(k=a,h)}else k=a,a=h;return a}function lr(){var t,r,e,n=k;return l.substr(k,4)===K?(t=K,k+=4):(t=h,0===F&&P(vt)),(n=t!==h&&(r=k,F++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===F&&P(E)),F--,(r=e===h?void 0:(k=r,h))!==h)?(L=n,null):(k=n,h))===h&&(n=k,l.substr(k,4)===Q?(t=Q,k+=4):(t=h,0===F&&P(bt)),n=t!==h&&(r=k,F++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===F&&P(E)),F--,(r=e===h?void 0:(k=r,h))!==h)?(L=n,null):(k=n,h)),n}function hr(){var t,r,e,n=k;return l.substr(k,4)===V?(t=V,k+=4):(t=h,0===F&&P(yt)),(n=t!==h&&(r=k,F++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===F&&P(E)),F--,(r=e===h?void 0:(k=r,h))!==h)?(L=n,!0):(k=n,h))===h&&(n=k,l.substr(k,4)===W?(t=W,k+=4):(t=h,0===F&&P(mt)),(n=t!==h&&(r=k,F++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===F&&P(E)),F--,(r=e===h?void 0:(k=r,h))!==h)?(L=n,!0):(k=n,h))===h)&&(n=k,l.substr(k,5)===X?(t=X,k+=5):(t=h,0===F&&P(Et)),(n=t!==h&&(r=k,F++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===F&&P(E)),F--,(r=e===h?void 0:(k=r,h))!==h)?(L=n,!1):(k=n,h))===h)&&(n=k,l.substr(k,5)===Y?(t=Y,k+=5):(t=h,0===F&&P(Tt)),n=t!==h&&(r=k,F++,C.test(l.charAt(k))?(e=l.charAt(k),k++):(e=h,0===F&&P(E)),F--,(r=e===h?void 0:(k=r,h))!==h)?(L=n,!1):(k=n,h)),n}if((r=N())!==h&&k===l.length)return r;throw r!==h&&k<l.length&&P({type:"end"}),er(Yt,e<l.length?l.charAt(e):null,e<l.length?rr(e,e+1):rr(e,e))}}}(),parse=(peggyParser.SyntaxError.prototype.name="PeggySyntaxError",peggyParser.parse),PeggySyntaxError=peggyParser.SyntaxError;exports.default=parse;