"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Logger_1=require("../Logger/Logger"),TextToken_1=require("./TextToken"),CompilerContext_1=require("./CompilerContext"),peg_1=require("./peg");class Options{constructor(e={}){this.logger=null!=(e=e.logger)?e:new Logger_1.default({namespace:"TRANSAX:COMPILER"})}}class Compiler{constructor(e={}){this.options=new Options(e)}tokenize(e){var t=[];for(const o of(0,peg_1.default)(e))0<t.length&&o instanceof TextToken_1.default&&t[t.length-1]instanceof TextToken_1.default?t[t.length-1].text+=o.text:t.push(o);return t}compile(e){var t=new CompilerContext_1.default,o=['""'];for(const n of this.tokenize(e))o.push(n.compile(t));for(let e=0;e<o.length;e++)["null","true","false"].includes(o[e])&&(o[e]='""');for(let e=1;e<o.length;e++)o[e-1].startsWith('"')&&o[e-1].endsWith('"')&&o[e].startsWith('"')&&(o[e-1]=o[e-1].slice(0,-1)+o[e].slice(1),o.splice(e,1),e--);let r="";return 0<t.parameters.length&&(r+=`{${t.parameters.join(",")}}`),0<t.globals.length&&(0===t.parameters.length&&(r+="_"),r+=`,{${t.globals.join(",")}}`),""===r?o.join("+"):`(${r})=>`+o.join("+")}}exports.default=Compiler;