"use strict";var __awaiter=this&&this.__awaiter||function(t,o,u,l){return new(u=u||Promise)(function(e,r){function n(t){try{i(l.next(t))}catch(t){r(t)}}function a(t){try{i(l.throw(t))}catch(t){r(t)}}function i(t){var r;t.done?e(t.value):((r=t.value)instanceof u?r:new u(function(t){t(r)})).then(n,a)}i((l=l.apply(t,o||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const promises_1=require("node:fs/promises"),yaml_1=require("yaml"),Util_1=require("./Util.cjs"),PathError_1=require("../Util/PathError.cjs");class PluginDictionary{constructor(t){if(!t||"object"!=typeof t)throw new PathError_1.default("Expected {{ path }} to be an object.");this.pattern=PathError_1.default.wrap("pattern",()=>{if("string"==typeof t.pattern&&0<t.pattern.length)return[t.pattern];if(Array.isArray(t.pattern)&&0<t.pattern.filter(t=>0<t.length).length)return t.pattern.filter(t=>0<t.length);throw new PathError_1.default("Expected {{ path }} to be a non-empty string or an array of non-empty strings.")}),this.handler=PathError_1.default.wrap("handler",()=>{const r=(t,e)=>__awaiter(this,void 0,void 0,function*(){var r=Util_1.default.localeFromPath(t);try{return{[r]:(yield e())||{}}}catch(t){return{[r]:{}}}});if("json"===t.handler)return t=>__awaiter(this,void 0,void 0,function*(){return r(t,()=>__awaiter(this,void 0,void 0,function*(){return JSON.parse(yield(0,promises_1.readFile)(t,"utf8"))}))});if("yaml"===t.handler)return t=>__awaiter(this,void 0,void 0,function*(){return r(t,()=>__awaiter(this,void 0,void 0,function*(){return(0,yaml_1.parse)(yield(0,promises_1.readFile)(t,"utf8"))}))});if("function"==typeof t.handler)return t.handler;throw new PathError_1.default('Expected {{ path }} to be "yaml", "json" or a function.')})}}exports.default=PluginDictionary;