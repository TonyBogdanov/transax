"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const write_file_atomic_1=require("write-file-atomic"),node_path_1=require("node:path"),yaml_1=require("yaml"),PluginOutputAnalysisType_1=require("../Type/PluginOutputAnalysisType.cjs"),PathError_1=require("../Util/PathError.cjs");class PluginOutputAnalysis{constructor(t){if(!t||"object"!=typeof t)throw new PathError_1.default("Expected {{ path }} to be an object.");if(this.flavor=PathError_1.default.wrap("flavor",()=>{if([PluginOutputAnalysisType_1.PluginOutputAnalysisFlavorMissing,PluginOutputAnalysisType_1.PluginOutputAnalysisFlavorUnused].includes(t.flavor))return t.flavor;throw new PathError_1.default("Expected {{ path }} to be a valid string value.")}),this.path=PathError_1.default.wrap("path",()=>{if("string"==typeof t.path&&0<t.path.length)return t.path;throw new PathError_1.default("Expected {{ path }} to be a non-empty string.")}),void 0===t.handler)switch((0,node_path_1.extname)(t.path)){case".txt":t.handler="txt";break;case".yml":case".yaml":t.handler="yaml";break;case".json":t.handler="json"}this.handler=PathError_1.default.wrap("handler",()=>{let r=t=>({});if(PluginOutputAnalysisType_1.PluginOutputAnalysisFlavorMissing===this.flavor?r=t=>t.getMissingTranslationKeys():PluginOutputAnalysisType_1.PluginOutputAnalysisFlavorUnused===this.flavor&&(r=t=>t.getUnusedTranslationKeys()),"txt"===t.handler)return(t,e)=>{return(0,write_file_atomic_1.default)(t,Object.entries(r(e)).map(([t,e])=>"## "+t+"\n"+e.join("\n")+"\n\n"))};if("yaml"===t.handler)return(t,e)=>(0,write_file_atomic_1.default)(t,(0,yaml_1.stringify)(r(e)));if("json"===t.handler)return(t,e)=>(0,write_file_atomic_1.default)(t,JSON.stringify(r(e),null,2));if("function"==typeof t.handler)return t.handler;throw new PathError_1.default('Expected {{ path }} to be "esm", "cjs" or a function.')})}}exports.default=PluginOutputAnalysis;