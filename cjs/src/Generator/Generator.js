"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Util_1=require("../Util"),Analyzer_1=require("../Analyzer/Analyzer"),Compiler_1=require("../Compiler/Compiler"),Logger_1=require("../Logger/Logger");class Options{constructor(e={}){var t;this.translations=null!=(t=e.translations)?t:{},this.analyzer=null!=(t=e.analyzer)?t:new Analyzer_1.default,this.compiler=null!=(t=e.compiler)?t:new Compiler_1.default,this.logger=null!=(t=e.logger)?t:new Logger_1.default({namespace:"Generator"})}}class Generator{constructor(e={}){this.keys={},this.options=new Options(e)}parse(e,t){if("object"!=typeof process)throw new Error("Generator.parse must be run in a NodeJS environment, `process` is not available.");for(const r of this.options.analyzer.analyze(e,t?Util_1.default.relative(process.cwd(),t):void 0)){this.keys.hasOwnProperty(r.key)||(this.keys[r.key]=[]);var s=this.keys[r.key];const t=`${r.source||"[inline code]"}::${r.line}:`+r.column;s.includes(r.source)||s.push(t)}return this}getMissingTranslationKeys(){var e={};for(const t of Object.keys(this.options.translations)){const s=this.options.translations[t];e[t]=Object.keys(this.keys).filter(e=>!s.hasOwnProperty(e))}return e}getUnusedTranslationKeys(){var e={};for(const s of Object.keys(this.options.translations)){var t=this.options.translations[s];e[s]=Object.keys(t).filter(e=>!this.keys.hasOwnProperty(e))}return e}getCompiledTranslationsDump(){var e=e=>e.match(/^[a-z_$][a-z0-9_$]*$/i)?e:JSON.stringify(e);let t=`{
`;for(const s of Object.keys(this.options.translations)){const r=this.options.translations[s];t+=`    ${e(s)}: {
`;for(const o of Object.keys(this.keys).filter(e=>r.hasOwnProperty(e)))t+=`        ${e(o)}: ${this.options.compiler.compile(r[o])},
`;t+=`    },
`}return t+"}"}getCompiledTranslationsDumpAsCJSExport(){return`module.exports = ${this.getCompiledTranslationsDump()};
`}getCompiledTranslationsDumpAsESMExport(){return`export default ${this.getCompiledTranslationsDump()};
`}}exports.default=Generator;