"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const GeneratorOptions_1=require("./GeneratorOptions.cjs"),CRC32_1=require("../Util/CRC32.cjs");class Generator{getDeduplicationDump(e){if(0===Object.keys(e).length)return"";let s="const ";for(let t=0;t<e.length;t++)s+=(0<t?"      ":"")+this.getDeduplicationVar(t)+" = "+e[t]+",\n";return s.substring(0,s.length-2)+";\n\n"}getDeduplicationVar(t){let e="";for(;e="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM"[t%52]+e,0<(t=Math.floor(t/52)););return"_"+e}constructor(t={}){this.keys={},this.options=t instanceof GeneratorOptions_1.default?t:new GeneratorOptions_1.default(t)}parse(t,e,s=!1){if(!s&&e)for(var[r,n]of Object.entries(this.keys))this.keys[r]=n.filter(t=>t.split("::")[0]!==e),0===this.keys[r].length&&delete this.keys[r];for(const o of this.options.analyzer.analyze(t,e)){this.keys.hasOwnProperty(o.key)||(this.keys[o.key]=[]);var i=this.keys[o.key];const e=`${o.source||"[inline code]"}::${o.line}:`+o.column;i.includes(o.source)||i.push(e)}return this}setTranslations(t,e){return this.options.translations[t]=e,this}mergeTranslations(t){for(var[e,s]of Object.entries(t))this.setTranslations(e,s);return this}removeTranslations(t){return this.options.translations.hasOwnProperty(t)&&delete this.options.translations[t],this}getTranslationsChecksum(){return CRC32_1.default.checksum(JSON.stringify(this.options.translations))}getMissingTranslationKeys(){var t={};for(const e of Object.keys(this.options.translations)){const s=this.options.translations[e];t[e]=Object.keys(this.keys).filter(t=>!s.hasOwnProperty(t))}return t}getUnusedTranslationKeys(){var t={};for(const s of Object.keys(this.options.translations)){var e=this.options.translations[s];t[s]=Object.keys(e).filter(t=>!this.keys.hasOwnProperty(t))}return t}getCompiledTranslationsDump(t,i){const o={};var e=Object.fromEntries(Object.keys(this.options.translations).map(t=>{const e=this.options.translations[t];var s={};for(const n of Object.keys(this.keys).filter(t=>e.hasOwnProperty(t))){var r=this.options.compiler.compile(e[n]);s[n]=r,i&&(o.hasOwnProperty(r)||(o[r]=0),o[r]++)}return[t,s]}));if(i){i.push(...Object.keys(o).filter(t=>1<o[t]));for(var[s,r]of Object.entries(e))for(var[n,a]of Object.entries(r)){a=i.indexOf(a);-1!==a&&(e[s][n]=this.getDeduplicationVar(a))}}var l,p,h=t=>t.match(/^[a-z_$][a-z0-9_$]*$/i)?t:JSON.stringify(t);let c=`{
`;for([l,p]of Object.entries(e)){c+=`    ${h(l)}: {
`;for(var[u,f]of Object.entries(p))t&&("{\n"!==c.slice(-2)&&(c+="\n"),this.keys[u].forEach(t=>c+=`        // ${t}
`)),c+=`        ${h(u)}: ${f},
`;c+=`    },
`}return c+"}"}getCompiledTranslationsDumpAsCJSExport(t){var e=[],t=`module.exports = ${this.getCompiledTranslationsDump(t,e)};
`;return this.getDeduplicationDump(e)+t}getCompiledTranslationsDumpAsESMExport(t){var e=[],t=`export default ${this.getCompiledTranslationsDump(t,e)};
`;return this.getDeduplicationDump(e)+t}}exports.default=Generator;